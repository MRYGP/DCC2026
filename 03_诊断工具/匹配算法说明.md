# ğŸ§® åŒ¹é…ç®—æ³•è¯´æ˜ v1.0

**ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-06  
**é€‚ç”¨åœºæ™¯**ï¼šè´·æŸ¥æŸ¥MVPæ ¸å¿ƒç®—æ³•  
**ä¾èµ–æ–‡æ¡£**ï¼šè¯Šæ–­é—®å·v1.0ã€é“¶è¡Œæ”¿ç­–åº“ã€æ”¹é€ æ–¹æ¡ˆåº“

---

## ä¸€ã€ç®—æ³•æ•´ä½“æ¶æ„

### 1.1 æ ¸å¿ƒæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å…¥ï¼šé—®å·ç­”æ¡ˆï¼ˆ15é“é¢˜ï¼‰                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1ï¼šäº§å“ç­›é€‰                                            â”‚
â”‚  â€¢ éå†äº§å“åº“ï¼ˆ15ä¸ªäº§å“ï¼‰                                    â”‚
â”‚  â€¢ æ£€æŸ¥å‡†å…¥æ¡ä»¶ï¼ˆç¡¬æ€§é—¨æ§›ï¼‰                                  â”‚
â”‚  â€¢ è¾“å‡ºï¼šç¬¦åˆæ¡ä»¶çš„äº§å“åˆ—è¡¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2ï¼šé¢åº¦è®¡ç®—                                            â”‚
â”‚  â€¢ å¯¹æ¯ä¸ªç¬¦åˆæ¡ä»¶çš„äº§å“                                      â”‚
â”‚  â€¢ å¥—ç”¨é¢åº¦ç®—æ³•ï¼ˆå‘ç¥¨è´·/ç¨è´·/æŠµæŠ¼è´·/...ï¼‰                   â”‚
â”‚  â€¢ è¾“å‡ºï¼šæ¯ä¸ªäº§å“çš„å¯è´·é¢åº¦                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3ï¼šäº§å“æ’åºå’Œæ¨è                                      â”‚
â”‚  â€¢ æŒ‰é¢åº¦ä»é«˜åˆ°ä½æ’åº                                        â”‚
â”‚  â€¢ æ ‡è®°"æœ€ä¼˜é€‰æ‹©"ï¼ˆé¢åº¦é«˜+åˆ©ç‡ä½ï¼‰                          â”‚
â”‚  â€¢ è¾“å‡ºï¼šæ¨èäº§å“åˆ—è¡¨ï¼ˆTop 3-5ï¼‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4ï¼šç¼ºå£è¯†åˆ«                                            â”‚
â”‚  â€¢ å¯¹æ¯”æ‰€æœ‰äº§å“çš„å‡†å…¥æ¡ä»¶                                    â”‚
â”‚  â€¢ æ‰¾å‡º"å·®ä¸€ç‚¹å°±èƒ½ç”³è¯·"çš„äº§å“                                â”‚
â”‚  â€¢ è®¡ç®—è¡¥é½åçš„é¢åº¦æå‡                                      â”‚
â”‚  â€¢ è¾“å‡ºï¼šæ¡ä»¶ç¼ºå£åˆ—è¡¨                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5ï¼šæ–¹æ¡ˆæ¨è                                            â”‚
â”‚  â€¢ æ ¹æ®ç¼ºå£ç±»å‹åŒ¹é…æ”¹é€ æ–¹æ¡ˆ                                  â”‚
â”‚  â€¢ è®¡ç®—ROIï¼ˆæŠ•å…¥/äº§å‡ºï¼‰                                      â”‚
â”‚  â€¢ æŒ‰ROIã€å‘¨æœŸã€æˆæœ¬æ’åº                                     â”‚
â”‚  â€¢ è¾“å‡ºï¼šæ¨èæ–¹æ¡ˆåˆ—è¡¨ï¼ˆTop 3ï¼‰                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å‡ºï¼šä½“æ£€æŠ¥å‘Š                                              â”‚
â”‚  â€¢ å½“å‰å¯è´·äº§å“å’Œé¢åº¦                                        â”‚
â”‚  â€¢ æ¡ä»¶ç¼ºå£åˆ†æ                                              â”‚
â”‚  â€¢ æ”¹é€ æ–¹æ¡ˆæ¨è                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.2 æ•°æ®æµ

```
é—®å·ç­”æ¡ˆ (JSON)
  â†“
æ•°æ®æ ‡å‡†åŒ–ï¼ˆåŒºé—´è½¬æ¢ä¸ºæ•°å€¼ï¼‰
  â†“
äº§å“ç­›é€‰ï¼ˆBooleanåˆ¤æ–­ï¼‰
  â†“
é¢åº¦è®¡ç®—ï¼ˆFormulaè®¡ç®—ï¼‰
  â†“
æ’åºä¼˜åŒ–ï¼ˆSort + Scoreï¼‰
  â†“
ç¼ºå£åˆ†æï¼ˆGap Detectionï¼‰
  â†“
æ–¹æ¡ˆåŒ¹é…ï¼ˆScheme Mappingï¼‰
  â†“
æŠ¥å‘Šç”Ÿæˆï¼ˆReport Templateï¼‰
```

---

## äºŒã€Step 1ï¼šäº§å“ç­›é€‰é€»è¾‘

### 2.1 å‡†å…¥æ¡ä»¶åˆ¤æ–­çŸ©é˜µ

æ¯ä¸ªäº§å“éƒ½æœ‰ä¸€ç»„å‡†å…¥æ¡ä»¶ï¼Œå¿…é¡»**å…¨éƒ¨æ»¡è¶³**æ‰èƒ½é€šè¿‡ç­›é€‰ã€‚

#### å‘ç¥¨è´·å‡†å…¥æ¡ä»¶

**äº¤é€šé“¶è¡Œ-å‘ç¥¨è´·**
```javascript
function checkJiaohangInvoiceLoan(answers) {
  return (
    answers.company_age >= 1 &&                    // æˆç«‹â‰¥1å¹´
    answers.annual_invoice_amount_min >= 1000000 && // å¹´å¼€ç¥¨â‰¥100ä¸‡
    answers.invoice_duration === "more_than_12m" && // è¿ç»­å¼€ç¥¨â‰¥12æœˆ
    answers.industry !== "real_estate" &&           // éæˆ¿åœ°äº§
    !hasSeriousCreditIssue(answers)                 // æ— ä¸¥é‡å¾ä¿¡é—®é¢˜
  );
}
```

**å¹³å®‰é“¶è¡Œ-å‘ç¥¨äº‘è´·**
```javascript
function checkPinganInvoiceLoan(answers) {
  return (
    answers.company_age >= 1 &&
    answers.annual_invoice_amount_min >= 2000000 && // å¹´å¼€ç¥¨â‰¥200ä¸‡
    answers.invoice_duration !== "less_than_6m" &&  // è¿ç»­å¼€ç¥¨â‰¥6æœˆ
    answers.industry !== "real_estate" &&
    !hasSeriousCreditIssue(answers)
  );
}
```

**æ‹›å•†é“¶è¡Œ-å‘ç¥¨è´·**
```javascript
function checkZhaohangInvoiceLoan(answers) {
  return (
    answers.company_age >= 1 &&
    answers.annual_invoice_amount_min >= 1500000 && // å¹´å¼€ç¥¨â‰¥150ä¸‡
    answers.invoice_duration !== "less_than_6m" &&
    answers.industry !== "real_estate" &&
    !hasSeriousCreditIssue(answers)
  );
}
```

---

#### ç¨è´·å‡†å…¥æ¡ä»¶

**å»ºè®¾é“¶è¡Œ-äº‘ç¨è´·**
```javascript
function checkJianhangTaxLoan(answers) {
  return (
    answers.company_age >= 1 &&
    answers.annual_tax_amount_min >= 20000 &&       // å¹´çº³ç¨â‰¥2ä¸‡
    ["level_a", "level_b"].includes(answers.tax_credit_level) && // A/Bçº§
    !hasSeriousCreditIssue(answers)
  );
}
```

**ä¸­å›½é“¶è¡Œ-é“¶ç¨è´·**
```javascript
function checkZhongguoTaxLoan(answers) {
  return (
    answers.company_age >= 1 &&
    answers.annual_tax_amount_min >= 30000 &&       // å¹´çº³ç¨â‰¥3ä¸‡
    ["level_a", "level_b"].includes(answers.tax_credit_level) &&
    !hasSeriousCreditIssue(answers)
  );
}
```

**å·¥å•†é“¶è¡Œ-ç¨åŠ¡è´·**
```javascript
function checkGonghangTaxLoan(answers) {
  return (
    answers.company_age >= 2 &&                     // æˆç«‹â‰¥2å¹´
    answers.annual_tax_amount_min >= 10000 &&       // å¹´çº³ç¨â‰¥1ä¸‡
    answers.tax_credit_level !== "level_d" &&       // éDçº§
    !hasSeriousCreditIssue(answers)
  );
}
```

---

#### æŠµæŠ¼è´·å‡†å…¥æ¡ä»¶

**ä¸­å›½é“¶è¡Œ-æŠµæŠ¼è´·**
```javascript
function checkZhongguoMortgageLoan(answers) {
  return (
    answers.has_property === true &&                // æœ‰æˆ¿äº§
    answers.property_value_min >= 1000000 &&        // æˆ¿äº§ä¼°å€¼â‰¥100ä¸‡
    !hasSeriousCreditIssue(answers)
  );
}
```

**æ‹›å•†é“¶è¡Œ-ç»è¥æŠµæŠ¼è´·**
```javascript
function checkZhaohangMortgageLoan(answers) {
  return (
    answers.has_property === true &&
    answers.property_value_min >= 1000000 &&
    answers.company_age >= 1 &&
    !hasSeriousCreditIssue(answers)
  );
}
```

---

#### é«˜æ–°ä¼ä¸šè´·å‡†å…¥æ¡ä»¶

**ä¸“ç²¾ç‰¹æ–°è´·-é€šç”¨**
```javascript
function checkSpecializedLoan(answers) {
  return (
    answers.special_qualification.includes("specialized") ||
    answers.special_qualification.includes("little_giant") &&
    answers.company_age >= 1 &&
    !hasSeriousCreditIssue(answers)
  );
}
```

**ç§‘åˆ›è´·-é‚®å‚¨é“¶è¡Œ**
```javascript
function checkTechInnovationLoan(answers) {
  return (
    (answers.special_qualification.includes("high_tech") ||
     answers.special_qualification.includes("tech_sme")) &&
    answers.company_age >= 1 &&
    !hasSeriousCreditIssue(answers)
  );
}
```

---

#### ç‰¹æ®Šäººç¾¤è´·å‡†å…¥æ¡ä»¶

**å¤§å­¦ç”Ÿåˆ›ä¸šè´·**
```javascript
function checkGraduateStartupLoan(answers) {
  return (
    answers.special_identity.includes("graduate") &&
    answers.company_age <= 5 &&                     // æ¯•ä¸š5å¹´å†…
    !hasSeriousCreditIssue(answers)
  );
}
```

**é€€ä¼å†›äººåˆ›ä¸šè´·**
```javascript
function checkVeteranStartupLoan(answers) {
  return (
    answers.special_identity.includes("veteran") &&
    !hasSeriousCreditIssue(answers)
  );
}
```

---

#### ç»è¥å¿«è´·å‡†å…¥æ¡ä»¶

**å·¥å•†é“¶è¡Œ-ç»è¥å¿«è´·**
```javascript
function checkGonghangQuickLoan(answers) {
  return (
    answers.company_age >= 1 &&
    (answers.annual_invoice_amount !== "no_invoice" ||
     answers.annual_tax_amount_min >= 10000) &&     // æœ‰å¼€ç¥¨æˆ–æœ‰çº³ç¨
    !hasSeriousCreditIssue(answers)
  );
}
```

**å¾®ä¼—é“¶è¡Œ-å¾®ä¸šè´·**
```javascript
function checkWeizhongBusinessLoan(answers) {
  return (
    answers.company_age >= 1 &&
    answers.annual_revenue_min >= 1000000 &&        // å¹´è¥æ”¶â‰¥100ä¸‡
    !hasSeriousCreditIssue(answers)
  );
}
```

**æ–°ç½‘é“¶è¡Œ-å¥½ä¼è´·**
```javascript
function checkXinwangBusinessLoan(answers) {
  return (
    answers.company_age >= 1 &&
    (answers.annual_invoice_amount !== "no_invoice" ||
     answers.annual_tax_amount_min >= 10000 ||
     answers.annual_revenue_min >= 1000000) &&
    !hasSeriousCreditIssue(answers)
  );
}
```

---

### 2.2 è¾…åŠ©åˆ¤æ–­å‡½æ•°

```javascript
// åˆ¤æ–­æ˜¯å¦æœ‰ä¸¥é‡å¾ä¿¡é—®é¢˜ï¼ˆä»é—®å·ç­”æ¡ˆæ¨æ–­ï¼‰
function hasSeriousCreditIssue(answers) {
  // MVPç‰ˆæœ¬ï¼šé—®å·æ²¡æœ‰ç›´æ¥é—®å¾ä¿¡ï¼Œåç»­ç‰ˆæœ¬è¡¥å……
  // æš‚æ—¶è¿”å›falseï¼ˆå‡è®¾å¾ä¿¡è‰¯å¥½ï¼‰
  return false;
}

// å°†é€‰é¡¹æšä¸¾å€¼è½¬æ¢ä¸ºæ•°å€¼ï¼ˆç”¨äºæ¯”è¾ƒï¼‰
function getNumericValue(enumValue, field) {
  const mapping = {
    // å¹´é™æ˜ å°„
    "less_than_1": 0.5,
    "1_to_2": 1.5,
    "2_to_3": 2.5,
    "3_to_5": 4,
    "more_than_5": 6,
    
    // é‡‘é¢æ˜ å°„ï¼ˆå–åŒºé—´ä¸­å€¼ï¼‰
    "less_than_100w": 50000,
    "100w_to_300w": 2000000,
    "300w_to_500w": 4000000,
    "500w_to_1000w": 7500000,
    "1000w_to_3000w": 20000000,
    "3000w_to_5000w": 40000000,
    "more_than_5000w": 60000000,
    
    // çº³ç¨é‡‘é¢æ˜ å°„
    "less_than_1w": 5000,
    "1w_to_5w": 30000,
    "5w_to_10w": 75000,
    "10w_to_30w": 200000,
    "30w_to_50w": 400000,
    "more_than_50w": 600000,
    
    // ç‰¹æ®Šå€¼
    "no_invoice": 0
  };
  
  return mapping[enumValue] || 0;
}
```

---

## ä¸‰ã€Step 2ï¼šé¢åº¦è®¡ç®—é€»è¾‘

### 3.1 å‘ç¥¨è´·é¢åº¦ç®—æ³•

**åŸºç¡€å…¬å¼**ï¼š
```
åŸºç¡€é¢åº¦ = å¹´å¼€ç¥¨é¢ Ã— ç³»æ•°
ç³»æ•°èŒƒå›´ï¼š5% - 30%
```

**ç³»æ•°å½±å“å› ç´ **ï¼š

| å› ç´  | å½±å“ | è¯´æ˜ |
|------|------|------|
| å¼€ç¥¨ç¨³å®šæ€§ | +5% | è¿ç»­12ä¸ªæœˆä»¥ä¸Šå¼€ç¥¨ |
| è¡Œä¸šä¼˜è´¨ | +5% | åˆ¶é€ ä¸šã€ITã€ç§‘ç ” |
| å¼€ç¥¨æ³¢åŠ¨å¤§ | -5% | æœˆåº¦å¼€ç¥¨æ³¢åŠ¨>50% |
| è¡Œä¸šæ•æ„Ÿ | -10% | æˆ¿åœ°äº§ã€å¨±ä¹ä¸š |

**å®ç°ä»£ç **ï¼š
```javascript
function calculateInvoiceLoanAmount(answers, baseRate) {
  let coefficient = baseRate; // åŸºç¡€ç³»æ•°ï¼ˆ5%-15%ï¼Œè§†é“¶è¡Œè€Œå®šï¼‰
  
  // å¼€ç¥¨ç¨³å®šæ€§åŠ åˆ†
  if (answers.invoice_duration === "more_than_12m") {
    coefficient += 0.05;
  }
  
  // è¡Œä¸šåŠ åˆ†
  const goodIndustries = ["manufacturing", "it_services", "research"];
  if (goodIndustries.includes(answers.industry)) {
    coefficient += 0.05;
  }
  
  // è¡Œä¸šæ‰£åˆ†
  if (answers.industry === "real_estate") {
    coefficient -= 0.10;
  }
  
  // è®¡ç®—åŸºç¡€é¢åº¦
  const invoiceAmount = answers.annual_invoice_amount_min;
  let amount = invoiceAmount * coefficient;
  
  // é“¶è¡Œé¢åº¦ä¸Šé™
  const maxLimit = 3000000; // 300ä¸‡ï¼ˆè§†å…·ä½“äº§å“è€Œå®šï¼‰
  amount = Math.min(amount, maxLimit);
  
  return Math.round(amount);
}

// ç¤ºä¾‹è°ƒç”¨
// äº¤é€šé“¶è¡Œå‘ç¥¨è´·ï¼šåŸºç¡€ç³»æ•°10%ï¼Œä¸Šé™300ä¸‡
const jiaohangAmount = calculateInvoiceLoanAmount(answers, 0.10);

// å¹³å®‰é“¶è¡Œå‘ç¥¨äº‘è´·ï¼šåŸºç¡€ç³»æ•°15%ï¼Œä¸Šé™500ä¸‡
const pinganAmount = calculateInvoiceLoanAmount(answers, 0.15);
```

---

### 3.2 ç¨è´·é¢åº¦ç®—æ³•

**åŸºç¡€å…¬å¼**ï¼š
```
åŸºç¡€é¢åº¦ = å¹´çº³ç¨é¢ Ã— å€æ•°
å€æ•°èŒƒå›´ï¼š5 - 30 å€
```

**å€æ•°å½±å“å› ç´ **ï¼š

| å› ç´  | å€æ•° | è¯´æ˜ |
|------|------|------|
| Açº§çº³ç¨ | Ã—1.5 | çº³ç¨ç­‰çº§Açº§ |
| Bçº§çº³ç¨ | Ã—1.2 | çº³ç¨ç­‰çº§Bçº§ |
| Cçº§çº³ç¨ | Ã—0.8 | çº³ç¨ç­‰çº§Cçº§ |
| è¿ç»­çº³ç¨3å¹´+ | +10% | çº³ç¨è®°å½•ç¨³å®š |

**å®ç°ä»£ç **ï¼š
```javascript
function calculateTaxLoanAmount(answers, baseMultiplier) {
  let multiplier = baseMultiplier; // åŸºç¡€å€æ•°ï¼ˆ10-20å€ï¼Œè§†é“¶è¡Œè€Œå®šï¼‰
  
  // çº³ç¨ç­‰çº§è°ƒæ•´
  if (answers.tax_credit_level === "level_a") {
    multiplier *= 1.5;
  } else if (answers.tax_credit_level === "level_b") {
    multiplier *= 1.2;
  } else if (answers.tax_credit_level === "level_c") {
    multiplier *= 0.8;
  } else if (answers.tax_credit_level === "unknown") {
    multiplier *= 0.8; // ä¿å®ˆä¼°è®¡ï¼ŒæŒ‰Cçº§å¤„ç†
  }
  
  // ä¼ä¸šå¹´é™åŠ åˆ†ï¼ˆæˆç«‹3å¹´ä»¥ä¸Šè§†ä¸ºç¨³å®šçº³ç¨ï¼‰
  if (["3_to_5", "more_than_5"].includes(answers.company_age)) {
    multiplier *= 1.1;
  }
  
  // è®¡ç®—åŸºç¡€é¢åº¦
  const taxAmount = answers.annual_tax_amount_min;
  let amount = taxAmount * multiplier;
  
  // é“¶è¡Œé¢åº¦ä¸Šé™
  const maxLimit = 3000000; // 300ä¸‡ï¼ˆå»ºè¡Œäº‘ç¨è´·ï¼‰æˆ–5000000ï¼ˆå·¥è¡Œç¨åŠ¡è´·ï¼‰
  amount = Math.min(amount, maxLimit);
  
  return Math.round(amount);
}

// ç¤ºä¾‹è°ƒç”¨
// å»ºè®¾é“¶è¡Œäº‘ç¨è´·ï¼šåŸºç¡€å€æ•°15å€ï¼Œä¸Šé™300ä¸‡
const jianhangAmount = calculateTaxLoanAmount(answers, 15);

// å·¥å•†é“¶è¡Œç¨åŠ¡è´·ï¼šåŸºç¡€å€æ•°20å€ï¼Œä¸Šé™500ä¸‡
const gonghangAmount = calculateTaxLoanAmount(answers, 20);
```

---

### 3.3 æŠµæŠ¼è´·é¢åº¦ç®—æ³•

**åŸºç¡€å…¬å¼**ï¼š
```
åŸºç¡€é¢åº¦ = æˆ¿äº§è¯„ä¼°å€¼ Ã— æŠµæŠ¼ç‡
æŠµæŠ¼ç‡èŒƒå›´ï¼š50% - 70%
```

**æŠµæŠ¼ç‡å½±å“å› ç´ **ï¼š

| æˆ¿äº§ç±»å‹ | æŠµæŠ¼ç‡ | è¯´æ˜ |
|---------|-------|------|
| ä½å®… | 70% | æœ€é«˜æŠµæŠ¼ç‡ |
| å•†é“º | 60% | æ¬¡ä¼˜æŠµæŠ¼ç‡ |
| å‚æˆ¿ | 50% | ä¿å®ˆæŠµæŠ¼ç‡ |
| å†™å­—æ¥¼ | 55% | ä¸­ç­‰æŠµæŠ¼ç‡ |

**å®ç°ä»£ç **ï¼š
```javascript
function calculateMortgageLoanAmount(answers, propertyType) {
  // æŠµæŠ¼ç‡æ˜ å°„ï¼ˆMVPç‰ˆæœ¬ç®€åŒ–ï¼Œé»˜è®¤ä½å®…70%ï¼‰
  const mortgageRates = {
    "residential": 0.70,  // ä½å®…
    "commercial": 0.60,   // å•†é“º
    "factory": 0.50,      // å‚æˆ¿
    "office": 0.55        // å†™å­—æ¥¼
  };
  
  const rate = mortgageRates[propertyType] || 0.70;
  
  // æˆ¿äº§ä½ç½®è°ƒæ•´ï¼ˆMVPç‰ˆæœ¬æš‚ä¸å®ç°ï¼Œåç»­æ ¹æ®åŸå¸‚æ•°æ®ä¼˜åŒ–ï¼‰
  // æˆ¿äº§å¹´é™è°ƒæ•´ï¼ˆMVPç‰ˆæœ¬æš‚ä¸å®ç°ï¼‰
  
  // è®¡ç®—åŸºç¡€é¢åº¦
  const propertyValue = answers.property_value_min;
  let amount = propertyValue * rate;
  
  // é“¶è¡Œé¢åº¦ä¸Šé™
  const maxLimit = 10000000; // 1000ä¸‡
  amount = Math.min(amount, maxLimit);
  
  return Math.round(amount);
}

// ç¤ºä¾‹è°ƒç”¨ï¼ˆé»˜è®¤ä½å®…ï¼‰
const mortgageAmount = calculateMortgageLoanAmount(answers, "residential");
```

---

### 3.4 é«˜æ–°ä¼ä¸šè´·é¢åº¦ç®—æ³•

**åŸºç¡€é¢åº¦**ï¼ˆæ ¹æ®èµ„è´¨ç­‰çº§ï¼‰ï¼š

| èµ„è´¨ | åŸºç¡€é¢åº¦ | è¯´æ˜ |
|------|---------|------|
| å›½å®¶çº§å°å·¨äºº | 1000ä¸‡ | æœ€é«˜ç­‰çº§ |
| çœçº§ä¸“ç²¾ç‰¹æ–° | 500ä¸‡ | æ¬¡é«˜ç­‰çº§ |
| é«˜æ–°æŠ€æœ¯ä¼ä¸š | 300ä¸‡ | åŸºç¡€ç­‰çº§ |
| ç§‘æŠ€å‹ä¸­å°ä¼ä¸š | 200ä¸‡ | å…¥é—¨ç­‰çº§ |

**å åŠ å› ç´ **ï¼š

| å› ç´  | é¢åº¦å¢åŠ  | è¯´æ˜ |
|------|---------|------|
| æœ‰å‘æ˜ä¸“åˆ© | +50-100ä¸‡ | æ ¸å¿ƒæŠ€æœ¯ |
| æœ‰å®ç”¨æ–°å‹ä¸“åˆ© | +20-50ä¸‡ | åŸºç¡€ä¸“åˆ© |
| æœ‰è‚¡æƒæŠ•èµ„ | +æŠ•èµ„é¢50% | æœ‰VC/PEæŠ•èµ„ |

**å®ç°ä»£ç **ï¼š
```javascript
function calculateHighTechLoanAmount(answers) {
  let amount = 0;
  
  // åŸºç¡€é¢åº¦ï¼ˆæ ¹æ®æœ€é«˜èµ„è´¨ï¼‰
  if (answers.special_qualification.includes("little_giant")) {
    amount = 10000000; // 1000ä¸‡
  } else if (answers.special_qualification.includes("specialized")) {
    amount = 5000000;  // 500ä¸‡
  } else if (answers.special_qualification.includes("high_tech")) {
    amount = 3000000;  // 300ä¸‡
  } else if (answers.special_qualification.includes("tech_sme")) {
    amount = 2000000;  // 200ä¸‡
  }
  
  // ä¸“åˆ©åŠ åˆ†
  if (answers.has_patent === "invention") {
    amount += 750000; // +75ä¸‡ï¼ˆå–ä¸­å€¼ï¼‰
  } else if (answers.has_patent === "utility") {
    amount += 350000; // +35ä¸‡ï¼ˆå–ä¸­å€¼ï¼‰
  }
  
  // è‚¡æƒæŠ•èµ„åŠ åˆ†ï¼ˆMVPç‰ˆæœ¬æš‚ä¸å®ç°ï¼Œé—®å·æœªæ”¶é›†ï¼‰
  
  return Math.round(amount);
}
```

---

### 3.5 ç‰¹æ®Šäººç¾¤è´·é¢åº¦ç®—æ³•

**å›ºå®šé¢åº¦**ï¼ˆæ”¿ç­–æ€§è´·æ¬¾ï¼‰ï¼š

| ç±»å‹ | ä¸ªäººåˆ›ä¸š | ä¼ä¸š | è¯´æ˜ |
|------|---------|------|------|
| å¤§å­¦ç”Ÿåˆ›ä¸š | æœ€é«˜30ä¸‡ | æœ€é«˜400ä¸‡ | è´¢æ”¿è´´æ¯ |
| é€€ä¼å†›äººåˆ›ä¸š | æœ€é«˜30ä¸‡ | æœ€é«˜500ä¸‡ | è´¢æ”¿è´´æ¯ |

**å®ç°ä»£ç **ï¼š
```javascript
function calculateSpecialIdentityLoanAmount(answers) {
  const amounts = [];
  
  if (answers.special_identity.includes("graduate")) {
    amounts.push({
      type: "å¤§å­¦ç”Ÿåˆ›ä¸šè´·-ä¸ªäºº",
      amount: 300000
    });
    amounts.push({
      type: "å¤§å­¦ç”Ÿåˆ›ä¸šè´·-ä¼ä¸š",
      amount: 4000000
    });
  }
  
  if (answers.special_identity.includes("veteran")) {
    amounts.push({
      type: "é€€ä¼å†›äººåˆ›ä¸šè´·-ä¸ªäºº",
      amount: 300000
    });
    amounts.push({
      type: "é€€ä¼å†›äººåˆ›ä¸šè´·-ä¼ä¸š",
      amount: 5000000
    });
  }
  
  return amounts;
}
```

---

### 3.6 ç»è¥å¿«è´·é¢åº¦ç®—æ³•

**ç»¼åˆè¯„åˆ†æ¨¡å‹**ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

```javascript
function calculateQuickLoanAmount(answers) {
  let score = 0;
  
  // è¥æ”¶è¯„åˆ†ï¼ˆ0-40åˆ†ï¼‰
  if (answers.annual_revenue_min >= 50000000) score += 40;
  else if (answers.annual_revenue_min >= 10000000) score += 30;
  else if (answers.annual_revenue_min >= 5000000) score += 20;
  else if (answers.annual_revenue_min >= 1000000) score += 10;
  
  // å¼€ç¥¨è¯„åˆ†ï¼ˆ0-30åˆ†ï¼‰
  if (answers.annual_invoice_amount_min >= 10000000) score += 30;
  else if (answers.annual_invoice_amount_min >= 5000000) score += 20;
  else if (answers.annual_invoice_amount_min >= 1000000) score += 10;
  
  // çº³ç¨è¯„åˆ†ï¼ˆ0-30åˆ†ï¼‰
  if (answers.annual_tax_amount_min >= 500000) score += 30;
  else if (answers.annual_tax_amount_min >= 100000) score += 20;
  else if (answers.annual_tax_amount_min >= 10000) score += 10;
  
  // é¢åº¦æ˜ å°„
  let amount = 0;
  if (score >= 80) amount = 5000000;      // 500ä¸‡
  else if (score >= 60) amount = 3000000; // 300ä¸‡
  else if (score >= 40) amount = 1000000; // 100ä¸‡
  else if (score >= 20) amount = 500000;  // 50ä¸‡
  else amount = 300000;                   // 30ä¸‡ï¼ˆæœ€ä½é¢åº¦ï¼‰
  
  return Math.round(amount);
}
```

---

## å››ã€Step 3ï¼šäº§å“æ’åºå’Œæ¨è

### 4.1 æ’åºé€»è¾‘

**å¤šç»´åº¦è¯„åˆ†**ï¼š

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| é¢åº¦ | 40% | é¢åº¦è¶Šé«˜ï¼Œåˆ†æ•°è¶Šé«˜ |
| åˆ©ç‡ | 30% | åˆ©ç‡è¶Šä½ï¼Œåˆ†æ•°è¶Šé«˜ |
| æ”¾æ¬¾é€Ÿåº¦ | 20% | é€Ÿåº¦è¶Šå¿«ï¼Œåˆ†æ•°è¶Šé«˜ |
| æ‹…ä¿æ–¹å¼ | 10% | ä¿¡ç”¨ > æŠµæŠ¼ > æ‹…ä¿ |

**è¯„åˆ†å…¬å¼**ï¼š
```javascript
function calculateProductScore(product, maxAmount, maxRate) {
  const amountScore = (product.amount / maxAmount) * 40;
  const rateScore = (1 - product.rate_avg / maxRate) * 30;
  const speedScore = getSpeedScore(product.speed) * 20;
  const guaranteeScore = getGuaranteeScore(product.guarantee_type) * 10;
  
  return amountScore + rateScore + speedScore + guaranteeScore;
}

function getSpeedScore(speed) {
  const mapping = {
    "å½“å¤©": 1.0,
    "1-3å¤©": 0.8,
    "3-5å¤©": 0.6,
    "1-2å‘¨": 0.4
  };
  return mapping[speed] || 0.5;
}

function getGuaranteeScore(type) {
  const mapping = {
    "ä¿¡ç”¨": 1.0,
    "æŠµæŠ¼": 0.6,
    "æ‹…ä¿": 0.3
  };
  return mapping[type] || 0.5;
}
```

---

### 4.2 æ¨èç­–ç•¥

**ç­–ç•¥1ï¼šæœ€å¤§åŒ–é¢åº¦**
- æ¨èé¢åº¦æœ€é«˜çš„å‰3ä¸ªäº§å“
- é€‚åˆé¢åº¦ä¼˜å…ˆçš„å®¢æˆ·

**ç­–ç•¥2ï¼šæœ€ä¼˜åˆ©ç‡**
- æ¨èåˆ©ç‡æœ€ä½çš„å‰3ä¸ªäº§å“
- é€‚åˆæˆæœ¬ä¼˜å…ˆçš„å®¢æˆ·

**ç­–ç•¥3ï¼šç»¼åˆæœ€ä¼˜**
- æ¨èç»¼åˆè¯„åˆ†æœ€é«˜çš„å‰3ä¸ªäº§å“
- é€‚åˆç»¼åˆè€ƒé‡çš„å®¢æˆ·ï¼ˆé»˜è®¤ï¼‰

**å®ç°ä»£ç **ï¼š
```javascript
function recommendProducts(matchedProducts, strategy = "comprehensive") {
  if (strategy === "max_amount") {
    return matchedProducts
      .sort((a, b) => b.amount - a.amount)
      .slice(0, 3);
  } else if (strategy === "best_rate") {
    return matchedProducts
      .sort((a, b) => a.rate_avg - b.rate_avg)
      .slice(0, 3);
  } else {
    // ç»¼åˆè¯„åˆ†
    const maxAmount = Math.max(...matchedProducts.map(p => p.amount));
    const maxRate = Math.max(...matchedProducts.map(p => p.rate_avg));
    
    return matchedProducts
      .map(p => ({
        ...p,
        score: calculateProductScore(p, maxAmount, maxRate)
      }))
      .sort((a, b) => b.score - a.score)
      .slice(0, 3);
  }
}
```

---

## äº”ã€Step 4ï¼šç¼ºå£è¯†åˆ«é€»è¾‘

### 5.1 ç¼ºå£æ£€æµ‹

**æ£€æµ‹é€»è¾‘**ï¼šéå†æ‰€æœ‰äº§å“ï¼Œæ‰¾å‡º"å·®ä¸€ç‚¹å°±èƒ½ç”³è¯·"çš„äº§å“

```javascript
function detectGaps(answers, allProducts) {
  const gaps = [];
  
  allProducts.forEach(product => {
    const checkResult = checkProductEligibility(product, answers);
    
    if (!checkResult.eligible && checkResult.nearMiss) {
      gaps.push({
        product_id: product.id,
        product_name: product.name,
        gap_type: checkResult.gap_type,
        current_value: checkResult.current_value,
        target_value: checkResult.target_value,
        gap_value: checkResult.gap_value,
        potential_amount: checkResult.potential_amount
      });
    }
  });
  
  // æŒ‰æ½œåœ¨é¢åº¦æå‡æ’åº
  return gaps.sort((a, b) => b.potential_amount - a.potential_amount);
}

// è¯¦ç»†æ£€æŸ¥æŸä¸ªäº§å“çš„å‡†å…¥æƒ…å†µ
function checkProductEligibility(product, answers) {
  const result = {
    eligible: false,
    nearMiss: false,
    gap_type: null,
    current_value: null,
    target_value: null,
    gap_value: null,
    potential_amount: 0
  };
  
  // ç¤ºä¾‹ï¼šå‘ç¥¨è´·çš„ç¼ºå£æ£€æµ‹
  if (product.type === "å‘ç¥¨è´·") {
    const requiredInvoice = product.min_invoice_amount;
    const currentInvoice = answers.annual_invoice_amount_min;
    
    if (currentInvoice >= requiredInvoice) {
      result.eligible = true;
    } else if (currentInvoice >= requiredInvoice * 0.5) {
      // å¦‚æœå½“å‰å¼€ç¥¨é¢â‰¥ç›®æ ‡çš„50%ï¼Œè§†ä¸º"æ¥è¿‘"
      result.nearMiss = true;
      result.gap_type = "invoice_insufficient";
      result.current_value = currentInvoice;
      result.target_value = requiredInvoice;
      result.gap_value = requiredInvoice - currentInvoice;
      result.potential_amount = estimateAmount(product, requiredInvoice);
    }
  }
  
  // å…¶ä»–äº§å“ç±»å‹ç±»ä¼¼...
  
  return result;
}
```

---

### 5.2 ç¼ºå£ç±»å‹åˆ†ç±»

| ç¼ºå£ç±»å‹ | è¯´æ˜ | å¯¹åº”æ–¹æ¡ˆ |
|---------|------|---------|
| `invoice_insufficient` | å¼€ç¥¨é¢ä¸è¶³ | å¼€ç¥¨æå‡æœ¯ |
| `tax_insufficient` | çº³ç¨é¢ä¸è¶³ | çº³ç¨æå‡æœ¯ |
| `tax_level_low` | çº³ç¨ç­‰çº§ä½ | çº³ç¨æå‡æœ¯ |
| `no_property` | æ— æŠµæŠ¼ç‰© | èµ„äº§å¢æŒæœ¯ |
| `no_qualification` | æ— ç‰¹æ®Šèµ„è´¨ | èµ„è´¨è®¤å®šæœ¯ |
| `company_too_young` | ä¼ä¸šå¹´é™ä¸è¶³ | æ—¶é—´ç­‰å¾…ï¼ˆæ— æ–¹æ¡ˆï¼‰ |

---

## å…­ã€Step 5ï¼šæ–¹æ¡ˆæ¨èé€»è¾‘

### 6.1 ç¼ºå£â†’æ–¹æ¡ˆæ˜ å°„

```javascript
function mapGapToScheme(gap) {
  const mapping = {
    "invoice_insufficient": {
      scheme_id: "S001",
      scheme_name: "å¼€ç¥¨æå‡æœ¯",
      cost: 110000,
      duration: "4-7ä¸ªæœˆ",
      roi_formula: (gapValue) => (gapValue * 0.15) / 110000
    },
    "tax_insufficient": {
      scheme_id: "S002",
      scheme_name: "çº³ç¨æå‡æœ¯",
      cost: 115000,
      duration: "6-18ä¸ªæœˆ",
      roi_formula: (gapValue) => (gapValue * 20) / 115000
    },
    "tax_level_low": {
      scheme_id: "S002",
      scheme_name: "çº³ç¨æå‡æœ¯",
      cost: 115000,
      duration: "6-18ä¸ªæœˆ",
      roi_formula: (currentAmount) => (currentAmount * 0.5) / 115000
    },
    "no_qualification": {
      scheme_id: "S003",
      scheme_name: "èµ„è´¨è®¤å®šæœ¯-é«˜æ–°",
      cost: 120000,
      duration: "6-18ä¸ªæœˆ",
      roi_formula: () => 3000000 / 120000
    }
  };
  
  return mapping[gap.gap_type] || null;
}
```

---

### 6.2 ROIè®¡ç®—

**ROIå…¬å¼**ï¼š
```
ROI = (é¢„æœŸé¢åº¦æå‡ / æŠ•å…¥æˆæœ¬) Ã— 100%
```

**ç¤ºä¾‹**ï¼š
```javascript
function calculateSchemeROI(gap, scheme) {
  // é¢„æœŸé¢åº¦æå‡
  const expectedIncrease = gap.potential_amount;
  
  // æŠ•å…¥æˆæœ¬
  const cost = scheme.cost;
  
  // ROI
  const roi = (expectedIncrease / cost) * 100;
  
  return {
    expected_increase: expectedIncrease,
    cost: cost,
    roi: roi.toFixed(2) + "%",
    payback_months: Math.ceil(cost / (expectedIncrease * 0.05 / 12)) // å‡è®¾å¹´åŒ–åˆ©æ¯5%
  };
}
```

---

### 6.3 æ–¹æ¡ˆæ’åº

**æ’åºç»´åº¦**ï¼š

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| ROI | 50% | ROIè¶Šé«˜ï¼Œä¼˜å…ˆçº§è¶Šé«˜ |
| å‘¨æœŸ | 30% | å‘¨æœŸè¶ŠçŸ­ï¼Œä¼˜å…ˆçº§è¶Šé«˜ |
| æˆæœ¬ | 20% | æˆæœ¬è¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜ |

```javascript
function rankSchemes(schemes) {
  const maxROI = Math.max(...schemes.map(s => parseFloat(s.roi)));
  const maxDuration = Math.max(...schemes.map(s => s.duration_months));
  const maxCost = Math.max(...schemes.map(s => s.cost));
  
  return schemes
    .map(s => ({
      ...s,
      score: (parseFloat(s.roi) / maxROI) * 50 +
             (1 - s.duration_months / maxDuration) * 30 +
             (1 - s.cost / maxCost) * 20
    }))
    .sort((a, b) => b.score - a.score);
}
```

---

## ä¸ƒã€å®Œæ•´ç®—æ³•ä¼ªä»£ç 

```javascript
// ä¸»å‡½æ•°
function diagnoseAndRecommend(questionnaireAnswers) {
  // Step 1: æ•°æ®é¢„å¤„ç†
  const normalizedAnswers = normalizeAnswers(questionnaireAnswers);
  
  // Step 2: åŠ è½½äº§å“åº“
  const allProducts = loadProductDatabase();
  
  // Step 3: äº§å“ç­›é€‰
  const eligibleProducts = allProducts.filter(product => {
    return checkProductEligibility(product, normalizedAnswers).eligible;
  });
  
  // Step 4: é¢åº¦è®¡ç®—
  const productsWithAmount = eligibleProducts.map(product => {
    return {
      ...product,
      amount: calculateAmount(product, normalizedAnswers),
      rate_avg: (product.rate_min + product.rate_max) / 2
    };
  });
  
  // Step 5: äº§å“æ’åºå’Œæ¨è
  const recommendedProducts = recommendProducts(productsWithAmount);
  
  // Step 6: ç¼ºå£è¯†åˆ«
  const gaps = detectGaps(normalizedAnswers, allProducts);
  
  // Step 7: æ–¹æ¡ˆæ¨è
  const schemes = gaps.map(gap => {
    const scheme = mapGapToScheme(gap);
    if (scheme) {
      return {
        ...scheme,
        ...calculateSchemeROI(gap, scheme),
        gap_description: formatGapDescription(gap)
      };
    }
    return null;
  }).filter(s => s !== null);
  
  const rankedSchemes = rankSchemes(schemes);
  
  // Step 8: ç”ŸæˆæŠ¥å‘Š
  return {
    current_status: {
      max_amount: Math.max(...productsWithAmount.map(p => p.amount), 0),
      product_count: productsWithAmount.length,
      recommended_products: recommendedProducts
    },
    gaps: gaps.slice(0, 3), // æœ€å¤šå±•ç¤º3ä¸ªç¼ºå£
    recommended_schemes: rankedSchemes.slice(0, 3), // æœ€å¤šæ¨è3ä¸ªæ–¹æ¡ˆ
    summary: generateSummary(productsWithAmount, gaps, rankedSchemes)
  };
}

// æ•°æ®æ ‡å‡†åŒ–
function normalizeAnswers(raw) {
  const invoiceLastYear = getNumericValue(raw.annual_invoice_amount_last_year, "amount");
  const invoiceYtd = getNumericValue(raw.invoice_amount_ytd, "amount");
  const taxLastYear = getNumericValue(raw.annual_tax_amount_last_year, "tax");
  const taxYtd = getNumericValue(raw.tax_amount_ytd, "tax");
  const annual_invoice_amount_min = Math.max(invoiceLastYear, invoiceYtd);
  const annual_tax_amount_min = Math.max(taxLastYear, taxYtd);
  
  return {
    ...raw,
    // å…¼å®¹æ—§å­—æ®µï¼ˆç”¨äºå¸ƒå°”/æšä¸¾åˆ¤æ–­ï¼‰
    annual_invoice_amount: raw.annual_invoice_amount_last_year || raw.invoice_amount_ytd || "no_invoice",
    annual_tax_amount: raw.annual_tax_amount_last_year || raw.tax_amount_ytd || "less_than_1w",
    company_age: getNumericValue(raw.company_age, "years"),
    annual_revenue_min: getNumericValue(raw.annual_revenue, "amount"),
    annual_invoice_amount_min,
    annual_tax_amount_min,
    property_value_min: raw.has_property ? getNumericValue(raw.property_value, "amount") : 0
  };
}

// é¢åº¦è®¡ç®—åˆ†å‘
function calculateAmount(product, answers) {
  switch(product.type) {
    case "å‘ç¥¨è´·":
      return calculateInvoiceLoanAmount(answers, product.base_rate);
    case "ç¨è´·":
      return calculateTaxLoanAmount(answers, product.base_multiplier);
    case "æŠµæŠ¼è´·":
      return calculateMortgageLoanAmount(answers, product.property_type);
    case "é«˜æ–°ä¼ä¸šè´·":
      return calculateHighTechLoanAmount(answers);
    case "ç‰¹æ®Šäººç¾¤è´·":
      return calculateSpecialIdentityLoanAmount(answers);
    case "ç»è¥å¿«è´·":
      return calculateQuickLoanAmount(answers);
    default:
      return 0;
  }
}

// ç”Ÿæˆæ‘˜è¦
function generateSummary(products, gaps, schemes) {
  const maxAmount = Math.max(...products.map(p => p.amount), 0);
  const potentialIncrease = gaps.length > 0 ? gaps[0].potential_amount : 0;
  const bestScheme = schemes.length > 0 ? schemes[0] : null;
  
  return {
    current_max_amount: maxAmount,
    potential_increase: potentialIncrease,
    improvement_percentage: maxAmount > 0 ? (potentialIncrease / maxAmount * 100).toFixed(0) + "%" : "N/A",
    best_scheme_name: bestScheme ? bestScheme.scheme_name : null,
    best_scheme_roi: bestScheme ? bestScheme.roi : null
  };
}
```

---

## å…«ã€æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹1ï¼šåˆ¶é€ ä¼ä¸š-é«˜å¼€ç¥¨-æœ‰æˆ¿äº§

**è¾“å…¥**ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š
```json
{
  "company_age": "3_to_5",
  "annual_invoice_amount_last_year": "500w_to_1000w",
  "invoice_amount_ytd": "500w_to_1000w",
  "annual_tax_amount_last_year": "10w_to_30w",
  "tax_amount_ytd": "10w_to_30w",
  "invoice_duration": "more_than_12m",
  "tax_credit_level": "level_b",
  "has_property": true,
  "property_value": "500w_to_1000w",
  "industry": "manufacturing"
}
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "current_status": {
    "max_amount": 5250000,
    "product_count": 6,
    "recommended_products": [
      {
        "product_name": "æ‹›å•†é“¶è¡Œ-ç»è¥æŠµæŠ¼è´·",
        "amount": 5250000,
        "rate_avg": 0.0449,
        "score": 92.5
      },
      {
        "product_name": "å¹³å®‰é“¶è¡Œ-å‘ç¥¨äº‘è´·",
        "amount": 1125000,
        "rate_avg": 0.08,
        "score": 78.3
      },
      {
        "product_name": "ä¸­å›½é“¶è¡Œ-é“¶ç¨è´·",
        "amount": 360000,
        "rate_avg": 0.04,
        "score": 65.7
      }
    ]
  },
  "gaps": [],
  "recommended_schemes": [],
  "summary": {
    "current_max_amount": 5250000,
    "potential_increase": 0,
    "improvement_percentage": "0%",
    "best_scheme_name": null,
    "best_scheme_roi": null
  }
}
```

---

### æµ‹è¯•ç”¨ä¾‹2ï¼šè´¸æ˜“ä¼ä¸š-ä½å¼€ç¥¨-æ— æˆ¿äº§

**è¾“å…¥**ï¼š
```json
{
  "company_age": "1_to_2",
  "annual_invoice_amount_last_year": "less_than_100w",
  "invoice_amount_ytd": "less_than_100w",
  "invoice_duration": "less_than_6m",
  "annual_tax_amount_last_year": "1w_to_5w",
  "tax_amount_ytd": "1w_to_5w",
  "tax_credit_level": "unknown",
  "has_property": false,
  "industry": "wholesale_retail"
}
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "current_status": {
    "max_amount": 500000,
    "product_count": 2,
    "recommended_products": [
      {
        "product_name": "æ–°ç½‘é“¶è¡Œ-å¥½ä¼è´·",
        "amount": 500000,
        "rate_avg": 0.108
      },
      {
        "product_name": "å¾®ä¼—é“¶è¡Œ-å¾®ä¸šè´·",
        "amount": 300000,
        "rate_avg": 0.072
      }
    ]
  },
  "gaps": [
    {
      "product_name": "äº¤é€šé“¶è¡Œ-å‘ç¥¨è´·",
      "gap_type": "invoice_insufficient",
      "current_value": 50000,
      "target_value": 1000000,
      "gap_value": 950000,
      "potential_amount": 2250000
    }
  ],
  "recommended_schemes": [
    {
      "scheme_name": "å¼€ç¥¨æå‡æœ¯",
      "cost": 110000,
      "duration": "4-7ä¸ªæœˆ",
      "expected_increase": 2250000,
      "roi": "2045.45%",
      "payback_months": 1
    }
  ],
  "summary": {
    "current_max_amount": 500000,
    "potential_increase": 2250000,
    "improvement_percentage": "450%",
    "best_scheme_name": "å¼€ç¥¨æå‡æœ¯",
    "best_scheme_roi": "2045.45%"
  }
}
```

---

### æµ‹è¯•ç”¨ä¾‹3ï¼šç§‘æŠ€ä¼ä¸š-é«˜æ–°èµ„è´¨-å¤§å­¦ç”Ÿåˆ›ä¸š

**è¾“å…¥**ï¼š
```json
{
  "company_age": "1_to_2",
  "annual_invoice_amount_last_year": "300w_to_500w",
  "invoice_amount_ytd": "300w_to_500w",
  "invoice_duration": "more_than_12m",
  "annual_tax_amount_last_year": "5w_to_10w",
  "tax_amount_ytd": "5w_to_10w",
  "tax_credit_level": "level_a",
  "has_property": false,
  "has_patent": "invention",
  "special_identity": ["graduate"],
  "special_qualification": ["high_tech", "tech_sme"],
  "industry": "it_services"
}
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "current_status": {
    "max_amount": 4000000,
    "product_count": 8,
    "recommended_products": [
      {
        "product_name": "é‚®å‚¨é“¶è¡Œ-ç§‘åˆ›è´·",
        "amount": 3750000,
        "rate_avg": 0.045
      },
      {
        "product_name": "å¤§å­¦ç”Ÿåˆ›ä¸šè´·-ä¼ä¸š",
        "amount": 4000000,
        "rate_avg": 0.02
      },
      {
        "product_name": "æ‹›å•†é“¶è¡Œ-å‘ç¥¨è´·",
        "amount": 600000,
        "rate_avg": 0.0675
      }
    ]
  },
  "gaps": [],
  "recommended_schemes": [],
  "summary": {
    "current_max_amount": 4000000,
    "potential_increase": 0,
    "improvement_percentage": "0%",
    "best_scheme_name": null,
    "best_scheme_roi": null
  }
}
```

---

### æµ‹è¯•ç”¨ä¾‹4-10ï¼ˆç®€åŒ–ç‰ˆï¼‰

| ç”¨ä¾‹ | åœºæ™¯ | æœŸæœ›åŒ¹é…äº§å“æ•° | æœŸæœ›ç¼ºå£æ•° | ä¸»æ¨æ–¹æ¡ˆ |
|------|------|--------------|----------|---------|
| 4 | æ— å¼€ç¥¨æ— çº³ç¨-æ–°å…¬å¸ | 0-1 | 2-3 | å¼€ç¥¨æå‡æœ¯ |
| 5 | é«˜å¼€ç¥¨-ä½çº³ç¨ | 3-4 | 1 | çº³ç¨æå‡æœ¯ |
| 6 | ä½å¼€ç¥¨-é«˜çº³ç¨ | 2-3 | 1 | å¼€ç¥¨æå‡æœ¯ |
| 7 | æœ‰æˆ¿äº§-æ— å¼€ç¥¨ | 2 | 1 | å¼€ç¥¨æå‡æœ¯ |
| 8 | ä¸“ç²¾ç‰¹æ–°-æ— ä¸“åˆ© | 2-3 | 0 | æ— éœ€æ”¹é€  |
| 9 | é€€ä¼å†›äºº-é›¶åŸºç¡€ | 2 | 0 | ä¼˜å…ˆç‰¹æ®Šäººç¾¤è´· |
| 10 | é«˜é¢åº¦-é«˜åˆ©ç‡-æœ‰è´·æ¬¾ | 5+ | 0 | Bä¸šåŠ¡ï¼ˆé™æˆæœ¬ï¼‰ |

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 9.1 è®¡ç®—ä¼˜åŒ–

**ç¼“å­˜ç­–ç•¥**ï¼š
- äº§å“åº“åŠ è½½åç¼“å­˜ï¼ˆä¸é¢‘ç¹å˜åŠ¨ï¼‰
- å‡†å…¥æ¡ä»¶åˆ¤æ–­ç»“æœç¼“å­˜
- é¢åº¦è®¡ç®—å…¬å¼é¢„ç¼–è¯‘

**å¹¶å‘è®¡ç®—**ï¼š
- äº§å“ç­›é€‰å¯å¹¶å‘æ‰§è¡Œ
- é¢åº¦è®¡ç®—å¯å¹¶å‘æ‰§è¡Œ
- æ€»è€—æ—¶æ§åˆ¶åœ¨<2ç§’

---

### 9.2 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**ç´¢å¼•è®¾è®¡**ï¼š
```sql
CREATE INDEX idx_product_type ON products(product_type);
CREATE INDEX idx_product_bank ON products(bank_name);
CREATE INDEX idx_min_conditions ON products(min_invoice_amount, min_tax_amount);
```

**æŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- é¿å…å…¨è¡¨æ‰«æï¼Œä½¿ç”¨æ¡ä»¶è¿‡æ»¤
SELECT * FROM products 
WHERE product_type = ? 
  AND min_invoice_amount <= ?
  AND min_tax_amount <= ?
LIMIT 20;
```

---

## åã€å¼‚å¸¸å¤„ç†

### 10.1 å¸¸è§å¼‚å¸¸

| å¼‚å¸¸ | å¤„ç†æ–¹å¼ |
|------|---------|
| é—®å·æ•°æ®ä¸å®Œæ•´ | æç¤ºç”¨æˆ·è¡¥å……å¿…å¡«é¡¹ |
| æ‰€æœ‰äº§å“å‡ä¸åŒ¹é… | è¿”å›"æš‚æ— åŒ¹é…äº§å“"+ æ¨èæ”¹é€ æ–¹æ¡ˆ |
| é¢åº¦è®¡ç®—å¼‚å¸¸ | è¿”å›0ï¼Œè®°å½•æ—¥å¿— |
| æ–¹æ¡ˆæ˜ å°„å¤±è´¥ | è·³è¿‡è¯¥æ–¹æ¡ˆï¼Œç»§ç»­å…¶ä»–æ–¹æ¡ˆ |

---

### 10.2 è¾¹ç•Œcaseå¤„ç†

```javascript
// æ— åŒ¹é…äº§å“æ—¶çš„å¤„ç†
if (eligibleProducts.length === 0) {
  return {
    current_status: {
      max_amount: 0,
      product_count: 0,
      recommended_products: [],
      message: "æ ¹æ®æ‚¨å½“å‰çš„æƒ…å†µï¼Œæš‚æ—¶æ²¡æœ‰å®Œå…¨åŒ¹é…çš„äº§å“ã€‚ä½†é€šè¿‡ä»¥ä¸‹æ”¹é€ æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥è¾¾åˆ°ç”³è¯·æ¡ä»¶ï¼š"
    },
    gaps: detectGaps(normalizedAnswers, allProducts),
    recommended_schemes: /* æ¨èæ–¹æ¡ˆ */
  };
}
```

---

## åä¸€ã€ç‰ˆæœ¬æ›´æ–°è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| v1.0 | 2025-12-06 | åˆç‰ˆï¼Œå®Œæ•´ç®—æ³•è®¾è®¡ | Claude |

---

**æ–‡æ¡£çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**äº¤ä»˜æ ‡å‡†**ï¼šåç«¯å¼€å‘äººå‘˜å¯ç›´æ¥æŒ‰æ­¤æ–‡æ¡£å®ç°åŒ¹é…ç®—æ³•  
**ä¸‹ä¸€æ­¥**ï¼šåˆ›å»º"é¡¹ç›®è¿›åº¦è¿½è¸ªå™¨.md"

---

*æ³¨ï¼šä»¥ä¸Šæ•°æ®ä¸ºç¤ºä¾‹ï¼Œå®é™…ä»¥é“¶è¡Œå®¡æ‰¹ä¸ºå‡†ã€‚*
