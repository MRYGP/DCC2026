# 贷款中介业务基座 - 项目知识库

**项目名称**：贷款中介业务基座（V0）  
**目标**：2周完成14项P0功能  
**开发模式**：实习生 + Claude Code  

---

## 技术栈

**后端**：
- 语言：Python 3.11+
- 框架：FastAPI
- ORM：SQLAlchemy 2.0
- 数据库：SQLite（V0阶段）
- 验证：Pydantic V2

**前端**：
- 框架：React 18
- UI库：Ant Design 5
- 构建：Vite
- 状态管理：React Query

**工具**：
- 版本控制：Git
- 包管理：pip（后端）、npm（前端）
- API文档：FastAPI自动生成（/docs）

---

## 项目结构

```
backend/
├── app/
│   ├── main.py              # FastAPI入口
│   ├── database.py          # 数据库连接
│   ├── models/              # SQLAlchemy模型
│   ├── schemas/             # Pydantic模式
│   ├── api/                 # API路由
│   ├── services/            # 业务逻辑
│   └── utils/               # 工具函数
└── data/
    └── database.db          # SQLite数据库

frontend/
├── src/
│   ├── api/                 # API封装
│   ├── components/          # 通用组件
│   ├── pages/               # 页面
│   └── utils/               # 工具函数
└── public/                  # 静态资源
```

---

## 代码规范

### API响应格式（统一）

**成功**：
```json
{
  "code": 200,
  "message": "success",
  "data": { /* 业务数据 */ }
}
```

**失败**：
```json
{
  "code": 400,
  "message": "错误描述",
  "errors": [
    {"field": "字段名", "message": "具体错误"}
  ]
}
```

### 命名规范

- **Python**：snake_case（函数、变量）、PascalCase（类）
- **JavaScript**：camelCase（函数、变量）、PascalCase（组件）
- **文件名**：小写+连字符（user-profile.tsx）
- **API路由**：小写+连字符（/api/v1/customer-list）

### 注释规范

- 每个函数必须有docstring（说明功能、参数、返回值）
- 复杂逻辑必须有行内注释
- TODO标记未完成的功能

---

## 核心业务规则

### 租户隔离（最重要！）

**规则**：不同中介的数据完全隔离

**实现**：
- 所有表都有`tenant_id`字段
- 所有查询都加`WHERE tenant_id = ?`
- API中间件自动注入`tenant_id`

**示例**：
```python
# ❌ 错误：没有租户隔离
customers = db.query(Customer).all()

# ✅ 正确：加租户过滤
customers = db.query(Customer).filter(
    Customer.tenant_id == current_tenant_id
).all()
```

### 操作留痕（审计日志）

**规则**：所有数据操作都要记录

**记录内容**：
- 谁操作（user_id）
- 操作什么（resource_type, resource_id）
- 做了什么（action_type: view/create/update/delete）
- 什么时间（created_at）
- 从哪里（ip_address）

### 免责声明（不可删除）

**规则**：固化在代码中，不可修改、不可删除

```python
DISCLAIMER = """
⚠️ 重要声明：
1. 本报告为初步评估，不代表银行审批结果
2. 实际贷款额度、利率、期限以银行审批为准
3. 改造方案为建议性质，不保证改造后必然通过审批
"""
```

所有报告必须自动带上这个声明。

---

## 开发工作流

### 开始新功能

1. **理解需求**（5分钟）
   - 读`05_开发文档/V0开发计划.md`中的功能描述
   - 明确验收标准
   - 有疑问立即问

2. **让Claude Code生成计划**（5分钟）
   ```
   帮我规划"批量导入Excel"功能的实现：
   - 使用pandas读取Excel
   - 验证13个必填字段
   - 批量插入数据库
   - 返回成功/失败统计
   
   给我实现步骤，不要直接生成代码
   ```

3. **确认计划**（5分钟）
   - 检查计划是否符合需求
   - 调整不合理的地方

4. **让Claude Code实现**（30-60分钟）
   ```
   按照刚才的计划实现，注意：
   - 遵循项目结构
   - 使用统一的响应格式
   - 添加必要的注释
   - 写单元测试
   ```

5. **测试功能**（30分钟）
   - 手动测试功能是否正常
   - 运行单元测试
   - 检查边界情况

6. **修复问题**（视情况）
   ```
   这个功能有个bug：[描述bug]
   预期：[应该怎样]
   实际：[实际怎样]
   帮我修复
   ```

### 使用检查点保护

**每开始新功能前**：
- Claude Code会自动创建检查点

**遇到问题时**：
- 按两次`Esc`或输入`/rewind`回退
- 可以恢复代码、对话或两者

### 子代理并行开发

**适用场景**：多个独立功能

**使用方式**：
```
使用子代理并行开发：
- 子代理1：实现批量导入Excel功能
- 子代理2：实现自动诊断分层功能
- 子代理3：实现三段式输出功能

每个子代理独立完成后，汇总给我完整代码
```

---

## 常见问题

### Q1：遇到不理解的错误怎么办？

**A1**：
```
我遇到这个错误：[粘贴完整错误信息]

执行的是：[描述你做了什么]
预期结果：[应该怎样]
实际结果：[实际怎样]

帮我解决
```

### Q2：Claude生成的代码有问题怎么办？

**A2**：
- 先用`/rewind`回退
- 重新描述需求（更详细）
- 或者直接告诉Claude哪里有问题

### Q3：不知道下一步做什么？

**A3**：
```
我刚完成了[功能名称]，下一步应该做什么？

参考：05_开发文档/V0开发计划.md 的Day X任务
```

---

## 每日工作流程

### 开始工作前（5分钟）

1. Git pull最新代码
2. 查看今天的任务（`05_开发文档/V0开发计划.md`）
3. 在Claude Code中说明今天计划

### 工作中（持续）

- 每完成一个小功能就git commit
- 遇到问题立即记录和解决
- 不要堆积多个功能一起commit

### 结束工作前（5分钟）

1. Git push所有代码
2. 更新进度记录
3. 记录明天要做的事

---

## 验收标准

每个功能完成后检查：

- [ ] 功能能运行
- [ ] 符合需求文档
- [ ] 有必要的注释
- [ ] 有单元测试（如适用）
- [ ] 响应格式统一
- [ ] 租户隔离正确
- [ ] 操作有审计日志
- [ ] Git commit已提交

---

## 知识库引用

**需求文档**：
- 总纲：`00_核心文档/贷款中介业务基座-总纲-v1.0.md`
- 框架设计：`00_核心文档/贷款中介业务基座-完整框架设计-v3.1.md`
- V0开发计划：`05_开发文档/V0开发计划.md`

**知识库**：
- 银行产品：`01_银行政策库/`
- 改造方案：`02_改造方案库/`
- 诊断工具：`03_诊断工具/`

---

**最后更新**：2026-01-27
**维护**：实习生遇到问题时更新这个文件
