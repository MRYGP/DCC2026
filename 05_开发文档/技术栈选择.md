# 技术栈选择 / Tech Stack Selection

**版本**：v1.0  
**更新日期**：2026-01-27  
**适用阶段**：V0开发

---

## 一、选型原则

### V0阶段原则

1. **快速开发**：2周完成MVP，选择熟悉的技术
2. **成熟稳定**：选择文档完善、社区活跃的技术
3. **易于维护**：代码清晰、可读性高
4. **适度前瞻**：V1扩展时不需要大规模重构

### 不追求的

- ❌ 最新技术（避免踩坑）
- ❌ 高并发（V0阶段用户少）
- ❌ 微服务（过度设计）

---

## 二、技术栈对比

### 后端框架对比

| 维度 | FastAPI（Python） | Express（Node.js） | Django（Python） |
|------|-------------------|-------------------|------------------|
| **开发速度** | ⭐⭐⭐⭐⭐ 自动API文档 | ⭐⭐⭐⭐ 灵活度高 | ⭐⭐⭐ 功能全但重 |
| **性能** | ⭐⭐⭐⭐ 异步高效 | ⭐⭐⭐⭐ 单线程高效 | ⭐⭐⭐ 同步较慢 |
| **学习曲线** | ⭐⭐⭐⭐ 简单直观 | ⭐⭐⭐⭐⭐ 灵活简单 | ⭐⭐ 概念多 |
| **生态** | ⭐⭐⭐⭐ 快速成长 | ⭐⭐⭐⭐⭐ 最成熟 | ⭐⭐⭐⭐⭐ 最全面 |
| **类型安全** | ⭐⭐⭐⭐ Pydantic | ⭐⭐⭐⭐ TypeScript | ⭐⭐⭐ Python类型提示 |
| **适合场景** | API快速开发 | 全栈项目 | 大型企业应用 |

**推荐**：FastAPI（Python）⭐

**理由**：
1. 自动生成API文档（省时间）
2. Pydantic数据验证（减少bug）
3. 异步支持（性能好）
4. 与数据科学库兼容（后期AI功能）

---

### 前端框架对比

| 维度 | React | Vue | Angular |
|------|-------|-----|---------|
| **生态** | ⭐⭐⭐⭐⭐ 最丰富 | ⭐⭐⭐⭐ 完善 | ⭐⭐⭐ 企业级 |
| **学习曲线** | ⭐⭐⭐ 中等 | ⭐⭐⭐⭐ 简单 | ⭐⭐ 复杂 |
| **灵活性** | ⭐⭐⭐⭐⭐ 高度灵活 | ⭐⭐⭐⭐ 中等 | ⭐⭐⭐ 约定多 |
| **社区** | ⭐⭐⭐⭐⭐ 最活跃 | ⭐⭐⭐⭐ 活跃 | ⭐⭐⭐ 稳定 |
| **B端组件** | ⭐⭐⭐⭐⭐ Ant Design | ⭐⭐⭐⭐ Element Plus | ⭐⭐⭐⭐ NG-ZORRO |

**推荐**：React + Ant Design ⭐

**理由**：
1. Ant Design专为B端设计（现成组件多）
2. 社区最活跃（遇到问题容易找答案）
3. 招人相对容易

---

### 数据库对比

| 维度 | SQLite | PostgreSQL | MySQL |
|------|--------|------------|-------|
| **V0适合度** | ⭐⭐⭐⭐⭐ 无需配置 | ⭐⭐⭐ 需要安装 | ⭐⭐⭐ 需要安装 |
| **性能** | ⭐⭐⭐ 小数据够用 | ⭐⭐⭐⭐⭐ 高性能 | ⭐⭐⭐⭐ 高性能 |
| **功能** | ⭐⭐⭐ 基础功能 | ⭐⭐⭐⭐⭐ 功能最全 | ⭐⭐⭐⭐ 功能全 |
| **迁移难度** | ⭐⭐⭐⭐⭐ 易迁移 | ⭐⭐⭐⭐ 易迁移 | ⭐⭐⭐⭐ 易迁移 |

**推荐**：SQLite（V0）→ PostgreSQL（V1）⭐

**理由**：
1. V0阶段用SQLite（单文件、无需安装、够用）
2. V1生产环境再升级PostgreSQL（数据迁移简单）
3. SQLAlchemy ORM支持两者（代码基本不改）

---

## 三、最终推荐方案

### ⭐ 方案A：Python全栈（推荐）

**技术栈**：
```
后端：
- 语言：Python 3.11+
- 框架：FastAPI
- ORM：SQLAlchemy 2.0
- 数据库：SQLite（V0）
- 验证：Pydantic V2
- 任务队列：APScheduler（定时任务）

前端：
- 框架：React 18
- 构建工具：Vite
- UI库：Ant Design 5
- 状态管理：React Query + Context
- HTTP客户端：Axios
- 样式：Tailwind CSS + Ant Design

开发工具：
- 代码编辑器：VS Code / Cursor
- 版本控制：Git
- API测试：FastAPI自动文档（/docs）
- 部署：Docker
```

**优势**：
- ✅ 开发速度最快（FastAPI自动生成文档）
- ✅ 类型安全（Pydantic + TypeScript）
- ✅ 生态完善（两边组件都多）
- ✅ 后期扩展性好（AI功能用Python方便）

**劣势**：
- ⚠️ 需要懂两种语言（Python + JavaScript）

---

### 方案B：Node.js全栈

**技术栈**：
```
后端：
- 语言：TypeScript
- 框架：Express / NestJS
- ORM：Prisma
- 数据库：SQLite（V0）

前端：
- 与方案A相同
```

**优势**：
- ✅ 前后端统一语言（TypeScript）
- ✅ 单人开发协调成本低

**劣势**：
- ⚠️ 数据处理不如Python方便
- ⚠️ 后期AI功能需要调用Python

---

## 四、开发环境配置

### 方案A（Python全栈）配置

#### 后端环境

```bash
# 1. 安装Python 3.11+
python --version  # 确认版本

# 2. 创建虚拟环境
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. 安装依赖
pip install fastapi uvicorn sqlalchemy pydantic python-multipart pandas openpyxl

# 4. 启动开发服务器
uvicorn main:app --reload
```

#### 前端环境

```bash
# 1. 安装Node.js 18+
node --version  # 确认版本

# 2. 创建React项目
cd frontend
npm create vite@latest . -- --template react-ts

# 3. 安装依赖
npm install antd axios react-query

# 4. 启动开发服务器
npm run dev
```

---

## 五、项目结构

### 后端结构

```
backend/
├── app/
│   ├── main.py              # FastAPI入口
│   ├── config.py            # 配置文件
│   ├── database.py          # 数据库连接
│   │
│   ├── models/              # 数据模型（SQLAlchemy）
│   │   ├── __init__.py
│   │   ├── customer.py
│   │   ├── tenant.py
│   │   └── audit_log.py
│   │
│   ├── schemas/             # 数据验证（Pydantic）
│   │   ├── __init__.py
│   │   ├── customer.py
│   │   └── tenant.py
│   │
│   ├── api/                 # API路由
│   │   ├── __init__.py
│   │   ├── customers.py
│   │   ├── diagnosis.py
│   │   └── config.py
│   │
│   ├── services/            # 业务逻辑
│   │   ├── __init__.py
│   │   ├── diagnosis.py     # 诊断逻辑
│   │   ├── plan.py          # 方案生成
│   │   └── export.py        # 导出功能
│   │
│   └── utils/               # 工具函数
│       ├── __init__.py
│       └── auth.py          # 认证中间件
│
├── data/                    # 数据文件
│   ├── database.db          # SQLite数据库
│   └── uploads/             # 上传文件
│
├── tests/                   # 测试
├── requirements.txt         # Python依赖
└── README.md
```

### 前端结构

```
frontend/
├── src/
│   ├── main.tsx            # 入口文件
│   ├── App.tsx             # 根组件
│   │
│   ├── api/                # API封装
│   │   ├── client.ts       # Axios配置
│   │   ├── customer.ts
│   │   └── diagnosis.ts
│   │
│   ├── components/         # 通用组件
│   │   ├── Layout.tsx
│   │   ├── UploadExcel.tsx
│   │   └── CustomerTable.tsx
│   │
│   ├── pages/              # 页面
│   │   ├── Dashboard.tsx
│   │   ├── CustomerList.tsx
│   │   ├── CustomerDetail.tsx
│   │   ├── PlanList.tsx
│   │   └── Settings.tsx
│   │
│   ├── hooks/              # 自定义Hooks
│   │   ├── useCustomers.ts
│   │   └── useDiagnosis.ts
│   │
│   ├── types/              # TypeScript类型
│   │   ├── customer.ts
│   │   └── diagnosis.ts
│   │
│   └── utils/              # 工具函数
│       └── format.ts
│
├── public/                 # 静态资源
├── package.json
└── README.md
```

---

## 六、依赖清单

### 后端依赖（requirements.txt）

```txt
# Web框架
fastapi==0.109.0
uvicorn[standard]==0.27.0
python-multipart==0.0.6

# 数据库
sqlalchemy==2.0.25
alembic==1.13.1

# 数据验证
pydantic==2.5.3
pydantic-settings==2.1.0

# Excel处理
pandas==2.1.4
openpyxl==3.1.2

# 任务调度
apscheduler==3.10.4

# 工具库
python-dotenv==1.0.0
```

### 前端依赖（package.json）

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.21.0",
    "antd": "^5.12.0",
    "axios": "^1.6.0",
    "@tanstack/react-query": "^5.17.0",
    "dayjs": "^1.11.10"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.2.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0"
  }
}
```

---

## 七、性能预估

### V0阶段（SQLite）

**支持规模**：
- 租户数量：100个中介
- 单租户客户：1000个
- 总客户数：10万
- 并发用户：50人

**响应时间**：
- 列表查询：< 500ms
- 诊断计算：< 2s
- Excel导入：100条/次，< 5s
- 报告生成：< 3s

### V1阶段（PostgreSQL）

**支持规模**：
- 租户数量：1000个中介
- 单租户客户：10000个
- 总客户数：1000万
- 并发用户：500人

---

## 八、升级路径

### V0 → V1 升级计划

**数据库升级**：
```bash
# 1. 导出SQLite数据
python scripts/export_sqlite.py

# 2. 创建PostgreSQL数据库
createdb loan_broker

# 3. 导入数据
python scripts/import_postgres.py

# 4. 更新配置
DATABASE_URL=postgresql://user:pass@localhost/loan_broker
```

**新增功能**：
- 前台问卷
- 服务商认证
- 数据分析大屏
- 权限管理

---

## 九、决策记录

### 为什么选FastAPI而不是Django？

**考虑因素**：
1. **开发速度**：FastAPI自动生成API文档，省时间
2. **性能**：异步支持，性能更好
3. **灵活性**：Django太重，V0不需要那么多功能
4. **学习曲线**：FastAPI更简单

### 为什么选React而不是Vue？

**考虑因素**：
1. **生态**：React生态更丰富（Ant Design）
2. **招人**：React开发者更多
3. **团队经验**：（根据实际情况调整）

### 为什么V0用SQLite？

**考虑因素**：
1. **快速启动**：无需安装配置
2. **够用**：V0阶段3个中介测试，数据量小
3. **易迁移**：后期升级PostgreSQL代码改动小

---

## 十、常见问题

### Q1：不熟悉Python怎么办？

**A1**：
- FastAPI官方文档很好
- 可以用AI辅助写代码（Claude/GPT）
- 社区活跃，问题容易搜到答案

### Q2：需要懂DevOps吗？

**A2**：
- V0阶段不需要
- 用Docker就够了
- V1再考虑K8s等

### Q3：一个人能完成吗？

**A3**：
- 有经验的全栈：2周可以
- 新手：可能需要3-4周
- 建议：用AI辅助开发

---

**文档版本**：v1.0  
**创建日期**：2026-01-27  
**维护人**：技术团队
