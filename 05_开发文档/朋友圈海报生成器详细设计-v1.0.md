# 朋友圈海报生成器详细设计

**版本**：v1.0  
**创建日期**：2026-02-06  
**功能定位**：杀手级功能，V1核心竞争力  
**优先级**：⭐⭐⭐⭐⭐  

---

## 一、功能定位

### 1.1 为什么是杀手级功能

**现实数据**：
- 90%中介都在发朋友圈（每天3-5条）
- <10%中介有公众号且会运营
- 朋友圈是中介最主要的获客渠道

**中介痛点**：
```
痛点1：不会设计
  - 90%中介不会做海报
  - 外包设计师成本高（50-200元/张）
  - 质量参差不齐

痛点2：没有品牌
  - 用别人的海报，没有自己品牌
  - 客户不知道找谁咨询
  - 无法建立品牌识别

痛点3：没有追踪
  - 发了海报不知道谁扫了
  - 无法追踪转化率
  - 数据归属不清
```

**我们的解决方案**：
```
✅ 系统自动生成：30秒完成，完全免费
✅ 自动带品牌：Logo + 名称 + 专属二维码
✅ 数据可追踪：扫码带partner_id，转化率清晰
✅ 6个专业模板：对应6个体质桶，内容专业
```

### 1.2 竞品对比

| 功能 | 贷查查（我们）| 竞品A | 竞品B | 设计师外包 |
|------|-------------|-------|-------|-----------|
| **海报生成** | ✅ 自动生成30秒 | ❌ 需要设计师 | ⚠️ 模板固定 | ❌ 1-2天 |
| **品牌定制** | ✅ 中介品牌 | ❌ 平台品牌 | ⚠️ 有限定制 | ✅ 完全定制 |
| **专属二维码** | ✅ 自动带 | ❌ 需要手动加 | ✅ 自动带 | ❌ 需要手动加 |
| **数据归属** | ✅ 归中介 | ❌ 归平台 | ⚠️ 共享 | ✅ 归中介 |
| **成本** | 0元 | 0元 | 0元 | 50-200元/张 |
| **专业度** | ✅ 专业设计 | ⚠️ 一般 | ⚠️ 一般 | ✅ 专业设计 |
| **效率** | ✅ 30秒 | ⚠️ 等设计师 | ✅ 即时 | ❌ 1-2天 |

**核心优势**：
- ✅ 完全免费（vs 外包50-200元/张）
- ✅ 秒速生成（vs 外包1-2天）
- ✅ 中介品牌（vs 平台品牌）
- ✅ 数据归属清晰（vs 平台数据）
- ✅ 专业设计（vs 竞品山寨）

---

## 二、用户场景与转化路径

### 2.1 完整转化路径
```
【中介端】
Step 1：中介登录后台
Step 2：点击"生成海报"
Step 3：选择模板（6个体质桶）
Step 4：实时预览（显示中介品牌）
Step 5：点击"下载"
Step 6：保存到手机相册

    ↓

【发布环节】
Step 7：打开微信
Step 8：选择海报图片
Step 9：发朋友圈
Step 10：配文案："测测你的XX体质"

    ↓

【客户端】
Step 11：客户刷朋友圈
Step 12：看到海报
Step 13：感兴趣 → 长按识别二维码
Step 14：进入H5页面（带partner_id）
Step 15：页面显示"XX贷款顾问"
Step 16：填写13字段
Step 17：提交

    ↓

【转化环节】
Step 18：获得ABC分层报告
Step 19：报告末尾显示："想了解更多？联系XX顾问 138****1234"
Step 20：客户联系中介
Step 21：中介跟进
Step 22：成交
```

### 2.2 转化率预期（假设数据）
```
中介发1条朋友圈海报
  ↓
朋友圈好友数：1000人
  ↓
曝光率：30%（300人看到）
  ↓
点击率（扫码率）：5%（15人扫码）
  ↓
完成率（填完表单）：30%（5人填完）
  ↓
咨询率：40%（2人咨询）
  ↓
成交率：50%（1人成交）

结论：
  1条海报 → 1个成交客户
  成交客佣金：3000-5000元
  海报成本：0元
  ROI：无限大
```

### 2.3 优化策略

**如果点击率<5%**：
```
原因分析：
  - 海报不够吸引人
  - 反差钩子不明显
  - 价值承诺不清晰

优化方向：
  - 优化海报设计（更醒目）
  - 强化反差钩子
  - 明确价值承诺
```

**如果完成率<30%**：
```
原因分析：
  - 13字段太多
  - 填写太复杂
  - 中途放弃

优化方向：
  - 简化字段（保留核心10个）
  - 优化填写体验
  - 增加进度提示
```

---

## 三、海报模板设计

### 3.1 设计规范

**尺寸**：1080x1920（9:16，适合手机屏幕）  
**文件格式**：PNG（带透明背景）  
**色彩模式**：RGB  
**分辨率**：72 DPI（屏幕显示）  

**设计原则**：
- 简洁明了：信息密度适中，不杂乱
- 视觉冲击：色彩对比强烈，吸引眼球
- 品牌突出：Logo/名称清晰可见
- 二维码醒目：位置显眼，易于扫描

### 3.2 模板1：流水体质诊断海报

**完整设计稿**：
```
┌─────────────────────────────────────┐
│  尺寸：1080x1920                     │
├─────────────────────────────────────┤
│                                     │  ← 50px上边距
│  [Logo 150x150]  XX贷款顾问          │  ← Logo区域（左上）
│                                     │  ← 中介品牌名称（Logo右侧）
│                                     │  ← 主题色下划线
│                                     │
│                                     │  ← 100px间距
│                                     │
│  你以为银行看流水规模，              │  ← 反差钩子标题（居中）
│  其实80%死在这3个细节                │  ← 字号：60px，加粗
│                                     │  ← 颜色：#333333
│                                     │
│                                     │  ← 80px间距
│                                     │
│  ✓ 3步自测你的流水体质               │  ← 价值承诺1（左对齐）
│  ✓ 1分钟知道能贷多少                 │  ← 价值承诺2（左对齐）
│  ✓ 免费生成改造方案                  │  ← 价值承诺3（左对齐）
│                                     │  ← 字号：40px
│                                     │  ← 颜色：#666666
│                                     │  ← ✓ 使用主题色
│                                     │
│                                     │  ← 200px间距
│                                     │
│       ┌──────────┐                  │  ← 二维码区域（居中）
│       │          │                  │  ← 尺寸：300x300
│       │ [QR CODE]│                  │  ← 内容：domain.com?partner_id=M001&source=moments_flow
│       │          │                  │
│       └──────────┘                  │
│       扫码测试                      │  ← 二维码说明（居中）
│                                     │  ← 字号：36px
│                                     │
│                                     │  ← 100px间距
│                                     │
│  联系方式：138****1234              │  ← 联系方式（居中）
│                                     │  ← 字号：36px
│                                     │  ← 颜色：#666666
│                                     │
│                                     │  ← 50px下边距
└─────────────────────────────────────┘
```

**固定元素**：
```yaml
Logo区域：
  位置：(50, 50)
  尺寸：150x150
  来源：tenants.logo_url
  圆角：10px

品牌名称：
  位置：(220, 120)
  字号：48px
  字体：PingFang SC Bold
  颜色：tenants.theme_color（默认#1890ff）

主题下划线：
  位置：(220, 140)
  长度：品牌名称宽度
  高度：4px
  颜色：tenants.theme_color

反差钩子标题：
  位置：居中，y=400
  字号：60px
  字体：PingFang SC Bold
  颜色：#333333
  行高：1.5
  最大宽度：900px
  
价值承诺列表：
  位置：(150, 650)
  字号：40px
  字体：PingFang SC Regular
  颜色：#666666
  行距：60px
  ✓符号颜色：tenants.theme_color

二维码：
  位置：居中，(390, 1000)
  尺寸：300x300
  内容：https://domain.com?partner_id={partner_id}&source=moments_flow
  容错率：M（15%）

二维码说明：
  位置：居中，y=1330
  字号：36px
  字体：PingFang SC Regular
  颜色：#666666

联系方式：
  位置：居中，y=1760
  字号：36px
  字体：PingFang SC Regular
  颜色：#666666
  格式："联系方式：{tenants.contact_phone}"
```

**可变参数**：
```yaml
中介配置：
  - logo_url：中介Logo图片URL
  - brand_name：中介品牌名称
  - contact_phone：中介联系电话
  - theme_color：主题色（可选，默认#1890ff）
  - partner_id：专属ID

内容桶配置：
  - 标题：你以为银行看流水规模，其实80%死在这3个细节
  - 价值承诺：
    * 3步自测你的流水体质
    * 1分钟知道能贷多少
    * 免费生成改造方案
  - 体质类型：流水体质
```

### 3.3 其他5个模板（设计规范一致）

**模板2：票税体质诊断海报**
```
反差钩子：你以为银行看开票额，其实80%死在票税比
价值承诺：
  ✓ 3步判断你的票税体质
  ✓ 1分钟算出可贷额度
  ✓ 免费获取提升方案
二维码：source=moments_invoice
```

**模板3：征信体质诊断海报**
```
反差钩子：你以为征信没逾期就行，其实80%死在查询次数
价值承诺：
  ✓ 5秒检测你的征信体质
  ✓ 找出隐藏的征信雷区
  ✓ 免费获取修复建议
二维码：source=moments_credit
```

**模板4：资产体质诊断海报**
```
反差钩子：你以为有房就能贷，其实80%死在抵押率
价值承诺：
  ✓ 1分钟估算房产可贷额
  ✓ 找出抵押物优化空间
  ✓ 免费获取提额方案
二维码：source=moments_asset
```

**模板5：资质体质诊断海报**
```
反差钩子：你以为高新资质没用，其实额度能翻倍
价值承诺：
  ✓ 3步判断资质认定价值
  ✓ 算出认定后可增额度
  ✓ 免费获取认定路径
二维码：source=moments_qualification
```

**模板6：行业体质诊断海报**
```
反差钩子：你以为行业不重要，其实80%死在准入限制
价值承诺：
  ✓ 1分钟判断行业准入度
  ✓ 找出行业包装空间
  ✓ 免费获取优化建议
二维码：source=moments_industry
```

---

## 四、技术实现方案

### 4.1 方案选型

**方案A：Canvas动态生成（前端）⭐⭐⭐⭐⭐（推荐）**
```
优势：
  ✅ 实时生成（前端计算，不占用服务器）
  ✅ 实时预览（所见即所得）
  ✅ 成本低（不消耗服务器资源）
  ✅ 可离线（生成后前端缓存）

劣势：
  ⚠️ 浏览器兼容性（需要测试）
  ⚠️ 性能依赖客户端（低端机可能慢）

技术栈：
  - HTML5 Canvas API
  - JavaScript
  - qrcode.js（二维码生成）
```

**方案B：服务端生成（Python + Pillow）**
```
优势：
  ✅ 性能稳定（不依赖客户端）
  ✅ 兼容性好（不依赖浏览器）

劣势：
  ❌ 服务器负载高（每次生成都要计算）
  ❌ 无法实时预览（需要请求服务器）
  ❌ 成本高（消耗服务器资源）

技术栈：
  - Python 3.x
  - Pillow（图片处理）
  - qrcode（二维码生成）
```

**决策：方案A（Canvas前端生成）**

理由：
- V1阶段中介数量不多（10-30个）
- 前端生成成本低，实时预览体验好
- 服务器资源节省

### 4.2 Canvas前端实现（详细代码）

**4.2.1 核心生成函数**
```javascript
/**
 * 生成朋友圈海报
 * @param {string} templateType - 模板类型（flow/invoice/credit/asset/qualification/industry）
 * @param {object} brandConfig - 品牌配置
 * @returns {Promise} - Base64图片数据
 */
async function generatePoster(templateType, brandConfig) {
  // 1. 创建Canvas
  const canvas = document.createElement('canvas');
  canvas.width = 1080;
  canvas.height = 1920;
  const ctx = canvas.getContext('2d');
  
  // 2. 填充背景色（白色）
  ctx.fillStyle = '#FFFFFF';
  ctx.fillRect(0, 0, 1080, 1920);
  
  // 3. 加载并绘制Logo
  await drawLogo(ctx, brandConfig.logo_url);
  
  // 4. 绘制品牌名称和下划线
  drawBrandName(ctx, brandConfig.brand_name, brandConfig.theme_color);
  
  // 5. 绘制反差钩子标题
  const template = getTemplate(templateType);
  drawTitle(ctx, template.title);
  
  // 6. 绘制价值承诺列表
  drawValueList(ctx, template.values, brandConfig.theme_color);
  
  // 7. 生成并绘制二维码
  const qrcodeUrl = `https://domain.com?partner_id=${brandConfig.partner_id}&source=moments_${templateType}`;
  await drawQRCode(ctx, qrcodeUrl);
  
  // 8. 绘制二维码说明
  drawQRCodeLabel(ctx);
  
  // 9. 绘制联系方式
  drawContact(ctx, brandConfig.contact_phone);
  
  // 10. 导出为Base64
  return canvas.toDataURL('image/png');
}

/**
 * 绘制Logo
 */
async function drawLogo(ctx, logoUrl) {
  const img = await loadImage(logoUrl);
  
  // 绘制圆角矩形作为背景
  ctx.save();
  roundRect(ctx, 50, 50, 150, 150, 10);
  ctx.clip();
  
  // 绘制Logo
  ctx.drawImage(img, 50, 50, 150, 150);
  ctx.restore();
}

/**
 * 绘制品牌名称和下划线
 */
function drawBrandName(ctx, brandName, themeColor) {
  // 品牌名称
  ctx.fillStyle = themeColor || '#1890ff';
  ctx.font = 'bold 48px PingFang SC, sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText(brandName, 220, 120);
  
  // 下划线
  const textWidth = ctx.measureText(brandName).width;
  ctx.fillRect(220, 140, textWidth, 4);
}

/**
 * 绘制反差钩子标题
 */
function drawTitle(ctx, title) {
  ctx.fillStyle = '#333333';
  ctx.font = 'bold 60px PingFang SC, sans-serif';
  ctx.textAlign = 'center';
  
  // 支持多行（自动换行）
  const lines = wrapText(ctx, title, 900);
  let y = 400;
  lines.forEach(line => {
    ctx.fillText(line, 540, y);
    y += 90; // 行高1.5倍字号
  });
}

/**
 * 绘制价值承诺列表
 */
function drawValueList(ctx, values, themeColor) {
  ctx.font = '40px PingFang SC, sans-serif';
  ctx.textAlign = 'left';
  
  let y = 650;
  values.forEach(value => {
    // 绘制✓符号
    ctx.fillStyle = themeColor || '#1890ff';
    ctx.fillText('✓', 150, y);
    
    // 绘制文本
    ctx.fillStyle = '#666666';
    ctx.fillText(value, 200, y);
    
    y += 60; // 行距
  });
}

/**
 * 生成并绘制二维码
 */
async function drawQRCode(ctx, url) {
  // 使用qrcode.js生成二维码
  const qrcode = new QRCode(document.createElement('div'), {
    text: url,
    width: 300,
    height: 300,
    correctLevel: QRCode.CorrectLevel.M
  });
  
  const qrImg = await loadImage(qrcode._el.querySelector('img').src);
  ctx.drawImage(qrImg, 390, 1000, 300, 300);
}

/**
 * 绘制二维码说明
 */
function drawQRCodeLabel(ctx) {
  ctx.fillStyle = '#666666';
  ctx.font = '36px PingFang SC, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('扫码测试', 540, 1330);
}

/**
 * 绘制联系方式
 */
function drawContact(ctx, phone) {
  ctx.fillStyle = '#666666';
  ctx.font = '36px PingFang SC, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText(`联系方式：${phone}`, 540, 1760);
}

// ===== 辅助函数 =====

/**
 * 加载图片
 */
function loadImage(url) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = 'Anonymous';
    img.onload = () => resolve(img);
    img.onerror = reject;
    img.src = url;
  });
}

/**
 * 绘制圆角矩形
 */
function roundRect(ctx, x, y, width, height, radius) {
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
}

/**
 * 文本自动换行
 */
function wrapText(ctx, text, maxWidth) {
  const lines = [];
  let currentLine = '';
  
  for (let char of text) {
    const testLine = currentLine + char;
    const metrics = ctx.measureText(testLine);
    
    if (metrics.width > maxWidth && currentLine !== '') {
      lines.push(currentLine);
      currentLine = char;
    } else {
      currentLine = testLine;
    }
  }
  
  if (currentLine) {
    lines.push(currentLine);
  }
  
  return lines;
}

/**
 * 获取模板配置
 */
function getTemplate(templateType) {
  const templates = {
    flow: {
      title: '你以为银行看流水规模，\n其实80%死在这3个细节',
      values: [
        '3步自测你的流水体质',
        '1分钟知道能贷多少',
        '免费生成改造方案'
      ]
    },
    invoice: {
      title: '你以为银行看开票额，\n其实80%死在票税比',
      values: [
        '3步判断你的票税体质',
        '1分钟算出可贷额度',
        '免费获取提升方案'
      ]
    },
    credit: {
      title: '你以为征信没逾期就行，\n其实80%死在查询次数',
      values: [
        '5秒检测你的征信体质',
        '找出隐藏的征信雷区',
        '免费获取修复建议'
      ]
    },
    asset: {
      title: '你以为有房就能贷，\n其实80%死在抵押率',
      values: [
        '1分钟估算房产可贷额',
        '找出抵押物优化空间',
        '免费获取提额方案'
      ]
    },
    qualification: {
      title: '你以为高新资质没用，\n其实额度能翻倍',
      values: [
        '3步判断资质认定价值',
        '算出认定后可增额度',
        '免费获取认定路径'
      ]
    },
    industry: {
      title: '你以为行业不重要，\n其实80%死在准入限制',
      values: [
        '1分钟判断行业准入度',
        '找出行业包装空间',
        '免费获取优化建议'
      ]
    }
  };
  
  return templates[templateType];
}
```

**4.2.2 前端页面实现**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>朋友圈海报生成器</title>
  <style>
    body {
      font-family: PingFang SC, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .template-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .template-btn {
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .template-btn:hover {
      border-color: #1890ff;
      background: #e6f7ff;
    }
    
    .template-btn.active {
      border-color: #1890ff;
      background: #1890ff;
      color: white;
    }
    
    .preview {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
    }
    
    .preview img {
      max-width: 100%;
      border: 1px solid #eee;
    }
    
    .actions {
      text-align: center;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      background: #1890ff;
      color: white;
      font-size: 16px;
      cursor: pointer;
      margin: 0 10px;
    }
    
    .btn:hover {
      background: #40a9ff;
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #1890ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1>朋友圈海报生成器</h1>
  
  <div class="template-selector">
    <button class="template-btn" onclick="selectTemplate('flow')">
      流水体质<br>诊断海报
    </button>
    <button class="template-btn" onclick="selectTemplate('invoice')">
      票税体质<br>诊断海报
    </button>
    <button class="template-btn" onclick="selectTemplate('credit')">
      征信体质<br>诊断海报
    </button>
    <button class="template-btn" onclick="selectTemplate('asset')">
      资产体质<br>诊断海报
    </button>
    <button class="template-btn" onclick="selectTemplate('qualification')">
      资质体质<br>诊断海报
    </button>
    <button class="template-btn" onclick="selectTemplate('industry')">
      行业体质<br>诊断海报
    </button>
  </div>
  
  <div class="preview">
    <h3>实时预览</h3>
    <div id="preview-container">
      请选择模板
    </div>
  </div>
  
  <div class="actions">
    <button class="btn" id="download-btn" onclick="downloadPoster()" disabled>
      下载海报
    </button>
    <button class="btn" onclick="generateAll()">
      生成全部6张
    </button>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
  <script src="poster-generator.js"></script>
</body>
</html>
```
```javascript
// poster-generator.js

let currentTemplate = null;
let currentPosterData = null;

// 从后端API获取品牌配置
async function getBrandConfig() {
  // 实际项目中从API获取
  // const res = await fetch('/api/brand-config');
  // return res.json();
  
  // 示例数据
  return {
    partner_id: 'M001',
    brand_name: 'XX贷款顾问',
    logo_url: '/path/to/logo.png',
    contact_phone: '138****1234',
    theme_color: '#1890ff'
  };
}

// 选择模板
async function selectTemplate(templateType) {
  // 更新按钮状态
  document.querySelectorAll('.template-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.closest('.template-btn').classList.add('active');
  
  currentTemplate = templateType;
  
  // 显示加载中
  const previewContainer = document.getElementById('preview-container');
  previewContainer.innerHTML = '生成中...';
  
  // 生成海报
  try {
    const brandConfig = await getBrandConfig();
    const posterData = await generatePoster(templateType, brandConfig);
    currentPosterData = posterData;
    
    // 显示预览
    previewContainer.innerHTML = `<img src="${posterData}" alt="海报预览">`;
    
    // 启用下载按钮
    document.getElementById('download-btn').disabled = false;
  } catch (error) {
    console.error('生成失败', error);
    previewContainer.innerHTML = '生成失败，请重试';
  }
}

// 下载海报
function downloadPoster() {
  if (!currentPosterData) return;
  
  const link = document.createElement('a');
  link.download = `${currentTemplate}-海报-${Date.now()}.png`;
  link.href = currentPosterData;
  link.click();
}

// 生成全部6张
async function generateAll() {
  const templates = ['flow', 'invoice', 'credit', 'asset', 'qualification', 'industry'];
  const brandConfig = await getBrandConfig();
  
  for (let template of templates) {
    try {
      const posterData = await generatePoster(template, brandConfig);
      
      // 自动下载
      const link = document.createElement('a');
      link.download = `${template}-海报-${Date.now()}.png`;
      link.href = posterData;
      link.click();
      
      // 延迟500ms避免浏览器拦截
      await new Promise(resolve => setTimeout(resolve, 500));
    } catch (error) {
      console.error(`生成${template}失败`, error);
    }
  }
  
  alert('全部6张海报已生成并下载！');
}
```

---

## 五、性能优化

### 5.1 生成速度优化

**目标**：生成时间<30秒

**优化策略**：

**1. Logo预加载**
```javascript
// 页面加载时预加载Logo
async function preloadLogo() {
  const brandConfig = await getBrandConfig();
  const img = new Image();
  img.src = brandConfig.logo_url;
  await img.decode(); // 确保解码完成
}

// 页面加载时执行
window.addEventListener('load', preloadLogo);
```

**2. 二维码缓存**
```javascript
const qrcodeCache = {};

async function generateQRCodeCached(url) {
  if (qrcodeCache[url]) {
    return qrcodeCache[url];
  }
  
  const qrImg = await generateQRCode(url);
  qrcodeCache[url] = qrImg;
  return qrImg;
}
```

**3. Canvas离屏渲染**
```javascript
// 使用OffscreenCanvas（支持Web Worker）
async function generatePosterOffscreen(templateType, brandConfig) {
  const offscreen = new OffscreenCanvas(1080, 1920);
  const ctx = offscreen.getContext('2d');
  
  // ... 绘制逻辑
  
  const blob = await offscreen.convertToBlob({type: 'image/png'});
  return URL.createObjectURL(blob);
}
```

### 5.2 内存优化

**问题**：连续生成6张海报可能导致内存溢出

**优化策略**：
```javascript
// 生成后立即释放Canvas
async function generateAndDownload(templateType, brandConfig) {
  const posterData = await generatePoster(templateType, brandConfig);
  
  // 立即下载
  downloadPoster(posterData, templateType);
  
  // 释放内存
  posterData = null;
}

// 分批生成（每次2张）
async function generateAllBatch() {
  const templates = ['flow', 'invoice', 'credit', 'asset', 'qualification', 'industry'];
  const brandConfig = await getBrandConfig();
  
  for (let i = 0; i < templates.length; i += 2) {
    const batch = templates.slice(i, i + 2);
    
    await Promise.all(batch.map(template => 
      generateAndDownload(template, brandConfig)
    ));
    
    // 延迟1秒释放内存
    await new Promise(resolve => setTimeout(resolve, 1000));
  }
}
```

---

## 六、验收标准

### 6.1 功能验收

- [ ] 6个模板都可正常生成
- [ ] 海报包含所有必要元素：
  - [ ] 中介Logo
  - [ ] 中介品牌名称
  - [ ] 反差钩子标题
  - [ ] 价值承诺列表
  - [ ] 专属二维码
  - [ ] 联系方式
- [ ] 二维码可正常扫描并跳转
- [ ] 下载的海报清晰（1080x1920）
- [ ] 生成速度<30秒/张

### 6.2 体验验收

**中介端**：
- [ ] 操作流程简单（选择→预览→下载）
- [ ] 实时预览（选择模板立即显示）
- [ ] 下载方便（一键保存）
- [ ] 批量生成（一次生成全部6张）

**客户端**：
- [ ] 海报美观（不显山寨）
- [ ] 二维码醒目（易于扫描）
- [ ] 品牌清晰（Logo/名称可见）
- [ ] 扫码后进入正确页面（带partner_id）

### 6.3 数据验收

**转化率目标**：
- [ ] 朋友圈海报点击率>5%
- [ ] 填表完成率>30%
- [ ] 客户咨询率>40%

**可追踪性**：
- [ ] 可区分不同模板来源（source=moments_flow）
- [ ] 可统计各模板转化率
- [ ] 可追踪到具体中介（partner_id）

---

## 七、上线计划

### 7.1 开发排期（4周）

**Week 1：设计与准备**
- [ ] 6个海报模板设计（设计师）
- [ ] Canvas生成代码框架
- [ ] 二维码生成逻辑

**Week 2：核心功能开发**
- [ ] 完整Canvas生成代码
- [ ] 前端页面实现
- [ ] 实时预览功能

**Week 3：优化与测试**
- [ ] 性能优化（生成速度<30秒）
- [ ] 兼容性测试（Chrome/Safari/微信浏览器）
- [ ] 真机测试（iPhone/Android）

**Week 4：上线准备**
- [ ] 用户文档（使用说明）
- [ ] 测试：10个中介生成海报
- [ ] 正式上线

### 7.2 灰度发布策略

**阶段1：内部测试**（3天）
- 3个试点中介测试
- 收集反馈，快速迭代

**阶段2：小范围灰度**（1周）
- 10个中介使用
- 监控转化率数据
- 优化海报设计

**阶段3：全量发布**
- 所有中介开放
- 持续监控数据
- 根据转化率优化模板

---

## 八、风险与应对

### 8.1 技术风险

| 风险 | 影响 | 概率 | 应对 |
|------|------|------|------|
| Canvas生成性能差 | 生成慢>30秒 | 中 | 改用服务端生成 |
| 浏览器兼容性问题 | 部分浏览器无法生成 | 低 | Polyfill或降级方案 |
| 内存溢出 | 批量生成时崩溃 | 中 | 分批生成，及时释放内存 |
| Logo加载失败 | 海报无Logo | 低 | 使用默认Logo |

### 8.2 业务风险

| 风险 | 影响 | 概率 | 应对 |
|------|------|------|------|
| 转化率<5% | 功能价值不明显 | 中 | 优化海报设计 |
| 中介觉得海报不够专业 | 使用率低 | 低 | 请专业设计师优化 |
| 中介觉得操作麻烦 | 使用率低 | 低 | 简化流程，增加教程 |

---

**文档状态**：✅ 已完成  
**下一步**：等待V1.2启动开发  
**责任人**：产品团队  
**开发负责人**：前端负责人  
**设计负责人**：UI设计师  
**最后更新**：2026-02-06