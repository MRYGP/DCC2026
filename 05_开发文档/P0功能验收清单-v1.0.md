# V0 MVP - P0功能验收清单

**版本**：v1.3  
**最后更新**：2026-02-05  
**本次更新**：功能15裁剪为15A最小版（录入+归因+留痕）
**创建日期**：2026-02-02  
**修订日期**：2026-02-05（功能15轻量化）  
**适用范围**：V0开发（2周交付）  
**维护人**：产品团队  
**验收原则**：可测试、可观察、可复现、二值判断（通过/不通过）

---

## 0. 当前战场（≤10行）

**阶段**：Phase 2 - V0/MVP（2周交付）

**本轮焦点**：把V0的P0功能变成"可测试、可对账、可验收"的口径

**V0闭环**：批量导入 → 诊断分层 → 三段式输出 → 任务/方案 → 提醒/复评

**验收目标**：
- 14项P0功能全部可验收
- 3个中介完成实际测试并反馈"可用"
- 端到端流程可跑通

## 0.1 V0部署形态裁决（重要）

**V0采用：多租户SaaS托管（统一入口）**

**交付物**：
- 一个统一部署的SaaS平台
- 子域名/路径级租户入口（如tenantA.xxx.com或xxx.com/tenantA）
- 多租户数据隔离（tenant_id）
- 白标化界面（每个租户看到自己的Logo/颜色）

**影响的验收口径**：
- 功能2（租户隔离）：验证跨租户数据不可见
- 功能11（白标配置）：验证子域名/路径入口生效
- 系统管理员：V0不验收系统管理员后台（手动运维）

**V1规划**：
- 私有化部署版本（本地自托管）
- 独立域名绑定+SSL

**说明**：此裁决解决了之前"本地部署 vs 多租户设计"的冲突。

---

## 1. 全局验收总则（所有功能共用）

### 1.1 角色与权限（V0默认）

- 仅支持"中介管理员单一角色"（登录后只能操作本租户数据）
- 无需复杂权限控制（V1规划）

### 1.2 核心业务规则（必须一致）

**分层阈值**：
- A类（立即可贷）：总分≥600
- B类（值得改造）：400≤总分<600
- C类（暂不跟进）：总分<400

**六宫格评分权重**：
- 流水体质：200分
- 票税体质：200分
- 征信体质：200分
- 资产体质：150分
- 资质体质：150分
- 行业体质：100分
- **总分**：1000分

**算法护栏**（强制）：
- 可解释：每个分层能说明基于哪些字段/规则
- 人工复核：允许A↔B改判且留痕
- 免责声明：所有报告必带且不可删除

**一票否决项（V0明确裁决）**：
- **V0一票否决项清单**（强制降为C类）：
  1. 法人征信有M3+逾期记录（连续3个月以上逾期）
  2. 法人征信有代偿记录（如果字段存在）
- **其他征信指标**（参与评分但不一票否决）：
  - 查询次数>10次：扣分（征信体质降低）
  - 月还款/收入>70%：扣分
  - 多头授信>5家：扣分
  - M1逾期：扣分但不一票否决
- **V1规划**：完整对齐征信六指标红线

### 1.3 V0评分规则表（可复现口径）

#### 说明
为确保"可解释"能够"可复现"，V0采用分段评分规则。所有评分计算必须可复现，以"金样例"为验收标准。

#### 流水体质（满分200分）

**对公流水月均（100分）**：
| 月均流水 | 得分 |
|---------|------|
| <10万 | 0-30分（线性插值） |
| 10-30万 | 30-60分（线性插值） |
| 30-50万 | 60-90分（线性插值） |
| ≥50万 | 90-100分 |
| 缺失/无效 | 0分 |

**流水稳定性（100分）**：
| 连续月数 | 得分 |
|---------|------|
| <6个月 | 0分 |
| 6-11个月 | 50分 |
| ≥12个月 | 100分 |
| 缺失/无效 | 0分 |

**计算规则**：流水体质 = 对公流水月均得分 + 流水稳定性得分

#### 票税体质（满分200分）

**年开票额（100分）**：
| 年开票 | 得分 |
|--------|------|
| <50万 | 0-30分（线性插值） |
| 50-200万 | 30-60分（线性插值） |
| 200-500万 | 60-90分（线性插值） |
| ≥500万 | 90-100分 |
| 缺失/无效 | 0分 |

**年纳税额（100分）**：
| 年纳税 | 得分 |
|--------|------|
| <2万 | 0-30分（线性插值） |
| 2-10万 | 30-60分（线性插值） |
| 10-20万 | 60-90分（线性插值） |
| ≥20万 | 90-100分 |
| 缺失/无效 | 0分 |

**计算规则**：票税体质 = 年开票得分 + 年纳税得分

#### 征信体质（满分200分）

**法人征信评分（200分）**：
| 征信状况 | 得分 |
|---------|------|
| 无逾期、查询<6次、负债合理 | 180-200分 |
| M1逾期或查询6-10次 | 120-179分 |
| 查询>10次或负债过高 | 60-119分 |
| M3+逾期或代偿 | 0分（一票否决） |
| 缺失/无法查询 | 60分（保守估计） |

**企业征信评分（已包含在法人评分中）**：
- V0简化：法人征信=征信体质全部得分
- V1：分离法人征信和企业征信

#### 资产体质（满分150分）

**抵押物价值（150分）**：
| 资产情况 | 得分 |
|---------|------|
| 有房产可抵押（价值>100万） | 120-150分 |
| 有房产可抵押（价值50-100万） | 80-119分 |
| 有车辆/设备可抵押 | 40-79分 |
| 无抵押物 | 0-39分 |
| 缺失/无效 | 20分（默认低值） |

#### 资质体质（满分150分）

**企业资质认定（150分）**：
| 资质情况 | 得分 |
|---------|------|
| 高新技术企业 | 120-150分 |
| 专精特新 | 100-130分 |
| 科技型中小企业 | 60-99分 |
| 无资质 | 0-59分 |
| 缺失/未填 | 30分（默认中低值） |

#### 行业体质（满分100分）

**行业风险评级（100分）**：
| 行业类型 | 得分 |
|---------|------|
| 政策支持行业（高新技术/制造业） | 80-100分 |
| 一般行业（服务业/贸易） | 50-79分 |
| 限制行业（高耗能/产能过剩） | 20-49分 |
| 禁入行业（房地产/金融投资） | 0分 |
| 缺失/未填 | 50分（中性值） |

#### 金样例（验收以此为准）

**金样例1：A类客户**
```
输入：
- 对公流水月均：50万，连续12个月
- 年开票：500万，年纳税：20万
- 法人征信：无逾期，查询5次
- 抵押物：房产价值150万
- 资质：高新技术企业
- 行业：制造业

计算：
- 流水体质：100 + 100 = 200
- 票税体质：100 + 100 = 200
- 征信体质：200
- 资产体质：150
- 资质体质：150
- 行业体质：90
- 总分：990

输出：
- 分层：A类
- 理由："总分990分≥600分，达到A类标准"
```

**金样例2：B类客户**
```
输入：
- 对公流水月均：25万，连续10个月
- 年开票：150万，年纳税：8万
- 法人征信：M1逾期1次，查询8次
- 抵押物：无
- 资质：无
- 行业：服务业

计算：
- 流水体质：50 + 50 = 100
- 票税体质：50 + 55 = 105
- 征信体质：150
- 资产体质：20
- 资质体质：30
- 行业体质：60
- 总分：465

输出：
- 分层：B类
- 理由："总分465分，在400-600分区间，值得改造"
```

**金样例3：C类客户（一票否决）**
```
输入：
- 对公流水月均：40万，连续12个月
- 年开票：300万，年纳税：15万
- 法人征信：M3+逾期
- 抵押物：房产价值100万
- 资质：无
- 行业：制造业

计算：
- 流水体质：80 + 100 = 180
- 票税体质：70 + 85 = 155
- 征信体质：0（一票否决）
- 资产体质：100
- 资质体质：30
- 行业体质：85
- 总分：550（但因一票否决强制降级）

输出：
- 分层：C类（强制降级）
- 理由："检测到M3+逾期，属于一票否决项，强制降为C类"
```

**验收标准**：
- ✅ 系统计算结果与金样例完全一致（总分误差≤5分可接受，分层必须一致）
- ✅ 评分明细可追溯到具体规则和输入字段
- ❌ 同一输入产生不同输出 → 验收失败

### 1.5 V0产品匹配与额度计算口径

#### 产品匹配规则（最小可行）

**硬条件匹配**（全部满足才算匹配）：
1. 年开票≥产品要求（如产品要求≥100万，客户必须≥100万）
2. 年纳税≥产品要求（如产品要求≥5万，客户必须≥5万）
3. 企业成立年限≥产品要求（如产品要求≥2年，客户必须≥2年）
4. 无M3+逾期记录（一票否决）

**字段缺失处理**：
- 关键字段缺失（年开票/年纳税/成立时间） → 标记"待补全"，不输出确定额度
- 可选字段缺失（抵押物/资质） → 按最低值计算，标注"如补全可能提升"

**匹配输出**：
- 列出所有符合条件的产品（3-5个为宜）
- 按预估额度从高到低排序
- 每个产品显示：银行名称、产品类型、预估额度、利率区间

#### 额度计算规则（最小可行）

**基础公式**：
```
预估额度 = min(
  年纳税 × 产品倍数,
  年开票 × 产品比例,
  产品额度上限
)
```

**示例1：税贷产品**
```
产品：XX银行税贷
- 产品倍数：30倍
- 产品上限：500万

客户：年纳税=20万
计算：min(20×30, 500) = min(600, 500) = 500万
预估额度：500万
```

**示例2：发票贷产品**
```
产品：XX银行发票贷
- 产品比例：50%
- 产品上限：300万

客户：年开票=500万
计算：min(500×50%, 300) = min(250, 300) = 250万
预估额度：250万
```

**示例3：抵押贷产品**
```
产品：XX银行抵押贷
- 抵押率：70%
- 产品上限：1000万

客户：房产价值=200万
计算：min(200×70%, 1000) = min(140, 1000) = 140万
预估额度：140万
```

#### 差距计算规则

**输入来源**：
- 目标贷款额：从导入字段"贷款需求"获取（格式：数值，单位万元）
- 当前最大额度：从产品匹配结果中取最高值

**计算公式**：
```
差距 = 目标贷款额 - 当前最大额度

if 差距 ≤ 0:
    输出：A类（已达标，无需改造）
else:
    输出：B类（需改造，差距=XX万）
```

**示例**：
```
目标贷款额：300万
当前最大额度：200万
差距：100万

输出：
- 当前可贷：200万
- 目标贷款：300万
- 需改造额度：100万
```

#### V1规划（不在V0范围）
- 复杂的评分模型（机器学习）
- 动态倍数调整（根据行业/地区）
- 多产品组合推荐（打包方案）

### 1.6 性能/可用性验收口径（V0）

#### 性能验收三段式门槛

| 功能 | 耗时 | 判定 | 说明 |
|------|------|------|------|
| **批量导入100条** | ≤5秒 | **Pass** | 理想目标，直接通过 |
| | 5-10秒 | **Pass*（有缺陷）** | 通过验收，但记录性能缺陷（不阻断交付，P1优化） |
| | >10秒 | **Fail** | 验收失败，必须修复后重新验收 |
| **单次诊断** | ≤3秒 | **Pass** | 理想目标 |
| | 3-5秒 | **Pass*（有缺陷）** | 通过但需优化 |
| | >5秒 | **Fail** | 必须修复 |
| **界面响应** | ≤2秒 | **Pass** | 理想目标 |
| | 2-4秒 | **Pass*（有缺陷）** | 通过但需优化 |
| | >4秒 | **Fail** | 必须修复 |

**说明**：
- Pass：直接通过验收，无需记录
- Pass*：通过验收可交付，但必须在缺陷列表登记，标注为P1优化项
- Fail：验收失败，阻断交付，必须修复

#### 可用性标准
- 3个中介完成测试用例
- 关键操作≤3次点击
- 错误信息清晰可懂

#### 测试数据要求
- 使用脱敏标识（客户A001/企业X等）
- 禁止出现身份证号、真实对公账号等可识别信息

---

## 2. P0功能验收清单（14项）

### A. 合规底座（4项功能）

#### 功能1：委托处理协议模板生成

**输入**：
- 中介公司名称
- 生效日期

**处理**：
- 生成固定模板PDF
- 自动插入固化免责声明

**输出**：
- PDF文件（可下载）
- 免责声明不可删除

**异常分支**：
- 缺少公司名称/日期 → 阻止生成并提示必填项
- PDF生成失败 → 显示错误信息，允许重试

**验收用例**：
```gherkin
Given 已输入公司名称="测试中介A"，日期="2026-02-02"
When 点击"生成协议"
Then 生成PDF成功且可下载
And PDF中显示公司名称和日期
And PDF最后一页包含完整免责声明

Given 生成的PDF
When 尝试编辑/删除免责声明区块
Then 不支持（免责声明固定存在）
```

**不通过场景**：
- ❌ PDF无法下载
- ❌ 免责声明缺失或可修改
- ❌ 公司名称或日期显示错误

---

#### 功能2：租户隔离+操作留痕

**输入**：
- tenant_id（租户ID）
- user_id（操作用户）
- 操作类型（view/create/update/delete/export）
- 资源类型与ID

**处理**：
- 所有表带tenant_id字段
- 中间件自动过滤（只返回本租户数据）
- 关键操作写入审计日志（保留1年）

**输出**：
- 数据隔离：租户A看不到租户B
- 审计日志：可查询/可导出（谁、何时、做了什么）

**异常分支**：
- 跨租户访问（URL猜测ID/接口传错tenant） → 403错误，并记录安全审计事件
- 日志存储失败 → 不阻止业务操作，但记录到错误日志

**验收用例**：
```gherkin
Given 系统中存在2个租户：租户A（tenant_id=1）、租户B（tenant_id=2）
And 租户A有客户"企业A001"，租户B有客户"企业B001"
When 用户以租户A身份登录
Then 客户列表只显示"企业A001"，不显示"企业B001"

Given 租户A的用户已登录
When 尝试通过URL访问租户B的客户（如/customers/B001）
Then 系统返回403错误
And 审计日志记录被拒绝访问事件

Given 租户A的管理员执行"批量导入10个客户"
When 导入完成
Then 审计日志至少记录：user_id、action=import、resource=customer、timestamp
```

**不通过场景**：
- ❌ 租户A能看到租户B的数据
- ❌ 操作未记录到审计日志
- ❌ 审计日志缺少必填字段（user_id/action/timestamp）

**安全测试用例（强化）**：
```gherkin
Given 租户A有客户ID列表：[A001, A002, A003]
And 租户B有客户ID列表：[B001, B002, B003]
When 租户A的用户执行以下操作：
    - 搜索客户（关键词："企业"）
    - 导出Excel
    - 生成诊断报告PDF
    - 下载对账记录
    - 查询审计日志
Then 所有结果中不得出现租户B的客户ID（包括B001/B002/B003）
And 不得通过URL猜测访问租户B的资源（如/customers/B001）
And 审计日志可定位到tenant_id=A + user_id + action

Given 租户A的管理员
When 尝试以下越权操作：
    - 修改URL参数：/api/customers?tenant_id=B
    - 直接访问：/customers/B001
    - 导出时传入：export?tenant_ids=A,B
Then 所有操作返回403错误或空结果
And 审计日志记录"拒绝访问"事件（security_violation）
```

**验收标准**：
- ✅ 跨租户数据100%不可见
- ✅ 越权访问100%被拒绝
- ✅ 安全事件100%被记录到审计日志

---

#### 功能3：数据导出/删除机制

**输入**：
- 导出请求（全部数据）
- 删除请求（全部数据）

**处理**：
- 导出：打包本租户所有数据（客户/报告/方案/日志），格式Excel/JSON，生成ZIP
- 删除：软删除+30天冷却期+二次确认；支持恢复（冷却期内）

**输出**：
- 导出：ZIP文件（5分钟内生成）
- 删除：状态标记（已删除/冷却期/已恢复）

**异常分支**：
- 导出数据量大超时 → 允许异步任务，界面显示进度/状态
- 删除后再次误操作 → 二次确认且提示影响范围
- 冷却期超过30天 → 自动物理删除

**验收用例**：
```gherkin
Given 租户A有50个客户记录
When 管理员点击"导出所有数据"
Then 5分钟内生成ZIP文件
And ZIP包含所有50个客户的完整数据（13个必填字段+诊断结果）
And 文件可成功下载

Given 管理员点击"删除所有数据"
When 完成二次确认
Then 数据状态改为"已删除"
And 客户列表为空（不显示已删除记录）
And deleted_at字段记录当前时间
And 系统显示："数据已删除，30天内可恢复"

Given 数据已删除15天
When 管理员点击"恢复数据"
Then 所有记录恢复可见
And deleted_at字段清空
And 审计日志记录恢复操作
```

**不通过场景**：
- ❌ 导出的Excel缺少字段或数据不完整
- ❌ 删除后立即物理删除（没有冷却期）
- ❌ 二次确认对话框缺失

---

#### 功能4：免责声明固化

**输入**：
- 任何"报告/方案/推荐"生成动作

**处理**：
- 免责声明作为系统常量固化
- 自动注入所有输出（评估报告、方案包、推荐页）

**输出**：
- 所有输出都包含免责声明
- 免责声明不可修改、不可删除

**异常分支**：
- 若某页面/导出缺免责声明 → 判定为阻断级缺陷（P0不通过）

**验收用例**：
```gherkin
Given 客户"企业A001"已完成诊断
When 管理员生成体检报告PDF
Then PDF最后一页必须包含免责声明
And 声明内容包含："本报告仅供参考，不构成融资承诺"
And 声明内容包含："预估额度以银行实际审批为准"

Given 管理员登录系统
When 查找免责声明配置入口（在设置/配置等所有可能位置）
Then 界面不提供任何编辑入口

Given 开发者尝试通过配置文件/数据库/API修改免责声明
When 调用任何可能的配置接口
Then 返回403错误或"不支持修改"提示
And 免责声明内容保持不变

Given 生成改造方案PDF
Then PDF最后一页必须包含免责声明
And 声明内容包含："改造成本为预估，实际以服务商报价为准"

Given 生成10份不同类型的报告（体检/方案/推荐）
When 查看所有报告的免责声明文字
Then 所有报告的声明文字完全一致（逐字比对）
And 声明不可复制后修改再粘贴回去
```

**不通过场景**：
- ❌ 任何报告缺少免责声明
- ❌ 声明可通过界面或数据库修改
- ❌ 声明内容不完整

---

### B. 业务功能（6项功能）

#### 功能5：批量导入Excel（13字段）

**输入**：
- xlsx文件
- **13个必填字段（最终字典）**：
  1. 企业名称（文本）
  2. 注册资本（数值，单位万元）
  3. 成立时间（日期，YYYY-MM-DD）
  4. 法人姓名（文本）
  5. 年开票（数值，单位万元）
  6. 年纳税（数值，单位万元）
  7. 对公流水月均（数值，单位万元）
  8. 法人征信（文本，如"无逾期"/"M1"/"M3+"）
  9. 企业征信（文本）
  10. 主营业务（文本）
  11. 行业（文本）
  12. 贷款需求（数值，单位万元）
  13. 抵押物情况（文本，如"有房产/150万"/"无"）

**说明**：
- ❌ "法人年龄"不在必填字段中
- 此为最终字典，任何字段增删必须走变更记录

**处理**：
- 字段验证（13个必填字段完整性）
- 格式校验（日期/数值/文本）
- 批量插入数据库

**输出**：
- 成功/失败统计
- 逐行错误列表（行号+字段名+错误原因）

**异常分支**：
- 缺字段/列名不匹配 → 阻止导入并提示缺失字段清单
- 单行数据非法（日期/数值/空值） → 跳过该行，错误列表给出行号+原因
- 重复导入（同企业名称+法人姓名） → 默认跳过并提示重复行数（V0口径）

**验收用例**：
```gherkin
Given 准备100条合规数据的Excel
When 管理员上传并导入
Then 3-5秒内完成
And 显示："成功100条，失败0条"
And 客户列表新增100条记录

Given Excel中第10行缺少"年开票"字段，第20行"注册资本"填写文本
When 上传导入
Then 系统返回错误列表：
    - "第10行：年开票字段缺失"
    - "第20行：注册资本格式错误，应为数字"
And 显示："成功98条，失败2条"

Given Excel列名错误（"年开票"写成"开票额"）
When 上传导入
Then 系统阻断并提示："缺少字段：年开票"
```

**不通过场景**：
- ❌ 100条数据导入超过10秒
- ❌ 字段验证不完整（漏检必填字段）
- ❌ 错误信息不清晰（只说"失败"，不说原因）
- ❌ 导入过程中系统卡死

---

#### 功能6：自动诊断分层（A/B/C）

**输入**：
- 客户13字段数据

**处理**：
- 六宫格评分（流水200、票税200、征信200、资产150、资质150、行业100）
- 汇总总分
- 根据阈值分层（A≥600、B=400-599、C<400）

**输出**：
- 分层结果（A/B/C）
- 评分明细（6个维度得分）
- 分层理由（可解释）

**异常分支**：
- 数据不足无法评分 → 标记为"待补全"，给出缺失字段清单
- 命中一票否决项（如M3+逾期） → 强制降级为C类，显示风险提示

**验收用例**：
```gherkin
Given 客户"企业A001"数据：
    - 流水体质：180分
    - 票税体质：190分
    - 征信体质：180分
    - 资产体质：100分
    - 资质体质：100分
    - 行业体质：80分
    - 总分：830分
When 系统执行诊断
Then 分层结果="A类（立即可贷）"
And 评分明细显示各维度得分
And 分层理由="总分830分≥600分，达到A类标准"

Given 客户总分800分（本应是A类）
But 法人征信有M3+逾期记录
When 系统执行诊断
Then 分层结果强制降为="C类"
And 风险提示="检测到严重逾期（M3+），属于一票否决项"

Given 客户缺少"年开票"和"年纳税"字段
When 运行诊断
Then 不输出A/B/C分层
And 提示："需补全以下字段：年开票、年纳税"
```

**不通过场景**：
- ❌ 分层结果错误（830分判为B类）
- ❌ 评分明细缺失或不可查看
- ❌ 一票否决项未生效
- ❌ 分层理由不清晰

### 诊断逻辑验收标准（强制）

**详细逻辑见**：`03_诊断工具/诊断逻辑说明.md`（必须严格遵守）

#### 征信六指标阈值（法人侧）

| 指标 | 警戒线 | 红线 | 验收方法 |
|------|-------|------|---------|
| 征信查询次数（近6月） | >6 | >10 | 输入7次，应标记"警戒"；输入11次，应标记"红线" |
| 月还款/收入比 | >50% | >70% | 输入60%，应标记"警戒"；输入80%，应标记"红线" |
| 小贷+信用卡负债占比 | >30% | >50% | 输入40%，应标记"警戒"；输入60%，应标记"红线" |
| 多头授信机构数 | >3 | >5 | 输入4个，应标记"警戒"；输入6个，应标记"红线" |
| 逾期记录（近2年） | 有M1 | 有M3+ | 输入M1，应标记"警戒"；输入M3，应标记"红线" |
| 担保/代偿记录 | 有担保 | 有代偿 | 输入担保，应标记"警戒"；输入代偿，应标记"红线" |

#### ABC分层标准

**A类客户**：
- 六宫格评分 >85分
- 无红线触发
- **输出要求**：显示"A类-优质客户"，建议"立即跟进"

**B类客户**：
- 六宫格评分 60-85分
- 有警戒线但无红线
- **输出要求**：显示"B类-改造后可做"，建议"先改造再跟进"

**C类客户**：
- 六宫格评分 <60分 或 有红线触发
- **输出要求**：显示"C类-风险过高"，建议"不建议跟进或需长期改造"

#### 诊断输出必须包含（强制）

体检报告必须包含以下4部分，缺一不可：

1. **体质分级**：
   - [ ] 明确显示A/B/C分类
   - [ ] 显示六宫格评分（如：流水85分、票税72分...）

2. **风险提示**：
   - [ ] 列出所有触发的警戒线（黄色警告）
   - [ ] 列出所有触发的红线（红色警告）
   - [ ] 每条风险提示必须说明"影响哪些产品"

3. **当前可贷额度（预估）**：
   - [ ] 扫描产品库，列出可匹配产品
   - [ ] 每个产品显示预估额度区间
   - [ ] **强制免责声明**："预估额度仅供参考，以银行实际审批为准"

4. **改造建议**：
   - [ ] 列出1-3个改造方案
   - [ ] 每个方案必须标注"作用于哪些体质维度"
   - [ ] 每个方案必须标注"预计提升空间"

#### 验收用例

**用例1：A类客户**
- 输入：月均流水80万、年开票500万、征信查询3次、无逾期
- 预期输出：
  - 分级：A类-优质客户
  - 风险提示：无
  - 可贷额度：税贷50-100万、流水贷80-150万
  - 改造建议：无需改造

**用例2：B类客户（有警戒线）**
- 输入：月均流水30万、年开票150万、征信查询8次（触发警戒线）
- 预期输出：
  - 分级：B类-改造后可做
  - 风险提示：⚠️ 征信查询次数8次（警戒线>6）
  - 可贷额度：税贷20-30万（部分产品不可用）
  - 改造建议：征信修复术（降低查询频率）

**用例3：C类客户（有红线）**
- 输入：月均流水5万、征信查询15次（触发红线）、有M3逾期
- 预期输出：
  - 分级：C类-风险过高
  - 风险提示：🔴 征信查询15次（红线>10）、🔴 M3逾期（红线）
  - 可贷额度：当前无可匹配产品
  - 改造建议：征信修复术（6-12个月）+ 流水优化术

---

#### 功能7：三段式输出（能做/值得做/不建议）

**输入**：
- 分层结果（A/B/C）

**处理**：
- 根据分层渲染不同输出模板

**输出**：
- **A类**：产品匹配清单+预估额度
- **B类**：改造方案包（任务清单+服务商推荐）
- **C类**：暂不建议申请+原因说明
- 所有输出都带免责声明

**异常分支**：
- 未完成免责声明加载 → 阻断展示（P0不通过）
- B类但缺口无法定位 → 输出"需人工补充信息/复核"

**验收用例**：
```gherkin
Given 客户"企业A001"诊断结果=A类
When 系统生成诊断报告
Then 报告包含：
    - 分层结果：A类（立即可贷）
    - 产品匹配清单：列出3-5个符合条件的产品
    - 预估额度：最高可贷XX万（基于XX银行XX产品）
    - 免责声明（最后一页）

Given 客户"企业B001"诊断结果=B类
When 系统生成诊断报告
Then 报告包含：
    - 分层结果：B类（值得改造）
    - 差距分析：当前可贷XX万，目标XX万，差距XX万
    - 改造方案包：推荐2-3个方案
    - 任务清单：具体要做什么、证据要求
    - 免责声明（最后一页）

Given 客户"企业C001"诊断结果=C类
When 系统生成诊断报告
Then 报告包含：
    - 分层结果：C类（暂不跟进）
    - 原因说明：明确指出不符合哪些条件
    - 建议：暂不建议申请，6个月后复评
    - 免责声明（最后一页）
```

**不通过场景**：
- ❌ A类客户未显示产品匹配清单
- ❌ B类客户未显示改造方案
- ❌ 任何报告缺少免责声明
- ❌ 格式不统一

---

#### 功能8：改造方案生成（标准输出包）

**输入**：
- 客户缺口数据（与目标产品准入条件对比后得到）

**处理**：
- 识别缺口（差什么、差多少）
- 匹配改造方案（从12个方案中选2-3个）
- 生成结构化方案包

**输出**：
- 方案包包含5个标准部分：
  1. 缺口清单（差什么、差多少）
  2. 任务清单（做什么、谁负责、证据要求、完成标准）
  3. 推荐服务商（2-3家可选，或中介自己找）
  4. 效果预览（预计能贷多少；⚠️以银行审批为准）
  5. 成本估算（成本、ROI、回本周期）
- 带免责声明

**异常分支**：
- 无合适方案匹配 → 输出"人工复核建议+需要补充的数据项"
- 服务商库为空 → 允许只输出"任务清单+中介自找服务商"（仍算通过）

**验收用例**：
```gherkin
Given B类客户"企业B001"年开票不足（当前30万，目标50万）
When 系统生成改造方案
Then 方案包含5个标准部分
And 缺口清单显示：年开票差20万（30万→50万）
And 任务清单包含：
    - 任务1：增加真实业务交易
      - 负责人：企业主
      - 证据要求：新客户合同、交易流水
      - 完成标准：新增开票20万
    - 任务2：梳理现有业务，确保所有交易都开票
And 推荐服务商：服务商A（费用XX）或企业主自找
And 效果预览：改造后预计年开票50万，可贷额度提升至XX万
And 成本估算：投入XX，增加额度XX，回本周期XX

Given 点击"导出PDF"
When 导出完成
Then PDF可下载且含免责声明
And 方案包5部分齐全
```

**不通过场景**：
- ❌ 方案缺少5个标准部分中的任何一个
- ❌ 任务清单不可执行（太模糊，如"改善征信"）
- ❌ 未显示服务商返佣披露
- ❌ 成本估算不合理或缺失

---

#### 功能9：自动提醒（A类立即/B类到期/C类复评）

**输入**：
- 客户分层结果
- 时间规则（A立即、B 3个月、C 6个月）

**处理**：
- 按触发条件生成提醒
- A类：诊断完成后立即提醒
- B类：3个月到期提醒
- C类：6个月复评提醒

**输出**：
- 系统内提醒（必须有）
- 邮件/微信通知（可选）

**异常分支**：
- 通知通道不可用（邮件/微信没配） → 不影响系统内提醒，在"系统设置"提示未配置
- 客户被删除/归档 → 对应提醒自动取消

**验收用例**：
```gherkin
Given 客户"企业A001"刚刚被诊断为A类
When 诊断完成后1分钟内
Then 系统内提醒显示："客户企业A001已达A类标准，可立即跟进进件"
And 管理员登录后在通知中心看到该提醒

Given 客户"企业B001"改造周期=3个月，开始时间=2026-02-02
When 当前时间=2026-05-02（3个月后）
Then 系统自动触发提醒："客户企业B001改造期已到，建议重新诊断"
And 管理员收到系统内通知

Given 客户"企业C001"分类为C类，分类时间=2026-02-02
When 当前时间=2026-08-02（6个月后）
Then 系统触发提醒："客户企业C001建议复评，查看是否有改善"

Given 系统配置为每天00:00执行提醒检查任务
When 当前时间到达00:00
Then 定时任务自动运行
And 扫描所有客户，识别需要提醒的记录
And 生成相应提醒
And 记录任务执行日志
```

**不通过场景**：
- ❌ A类客户诊断完成后10分钟内未提醒
- ❌ B类客户改造到期未提醒
- ❌ 提醒未按时触发（延迟超过1小时）
- ❌ 定时任务执行失败且无日志

---

#### 功能10：可解释+人工复核（改判留痕）

**输入**：
- 系统分层结果
- 评分明细
- 业务员改判操作与理由

**处理**：
- **可解释**：每个分层能说明基于哪些字段/规则；缺口可量化
- **人工复核**：允许A↔B改判
- **学习闭环**：记录改判理由，用于后续优化

**输出**：
- 分层理由可视化（文本即可）
- 人工改判记录（谁、何时、从X到Y、理由）

**异常分支**：
- 改判不填理由 → 阻止提交（理由必填）
- 改判后再次诊断 → 显示"系统判定 vs 人工判定"，以人工为准

**验收用例**：
```gherkin
Given 客户"企业A001"被系统判定为A类
When 管理员查看诊断结果
Then 显示完整评分明细：
    - 流水体质：180/200（对公流水月均50万，得90分；连续12个月，得90分）
    - 票税体质：190/200（年开票500万，得95分；年纳税20万，得95分）
    - ...其他维度
And 显示分层逻辑："总分830分≥600分，判定为A类"

Given 系统将客户"企业A001"判为A类
But 管理员认为应该是B类
When 管理员点击"人工改判"，选择B类，填写理由："客户实际流水存在季节性波动"
And 提交改判
Then 客户分层更新为B类
And 系统记录改判历史：
    - 原分层：A类（系统自动）
    - 新分层：B类（人工改判）
    - 改判人：管理员ID
    - 改判时间：2026-02-02 14:30
    - 改判理由："客户实际流水存在季节性波动..."

Given 客户"企业A001"有2次改判历史
When 管理员查看客户档案
Then 显示改判历史列表（可追溯所有改判记录）

Given 管理员尝试改判但不填理由
When 点击提交
Then 系统提示："理由必填"并阻止提交
```

**不通过场景**：
- ❌ 评分明细无法查看或不完整
- ❌ 改判后未记录历史
- ❌ 改判理由可以为空
- ❌ 普通用户可以改判（权限未限制）

---

### C. 白标配置（2项功能）

#### 功能11：Logo/颜色/域名配置（品牌外壳）

**输入**：
- Logo图片
- 主色调
- 公司名称、联系方式
- 域名（子域名，V0口径）

**处理**：
- 保存租户品牌配置
- 全站实时生效、风格统一

**输出**：
- 前台所有页面展示该租户品牌元素

**重要范围澄清**：
- V0：子域名/路径级隔离（如tenantA.xxx.com或xxx.com/tenantA）
- V1：独立域名绑定/SSL（不在V0范围）

**异常分支**：
- Logo尺寸/格式不合规 → 拒绝上传并提示规范（建议200x60px）
- 主色调无效值 → 使用默认色并提示

**验收用例**：
```gherkin
Given 管理员登录白标配置页面
When 上传Logo图片（PNG格式，200x60像素），选择主色调="#FF6B00"
And 点击"保存"
Then 系统显示"配置已保存"
And 刷新页面后，Logo显示在页面顶部
And 按钮背景色、链接颜色变为橙色

Given 管理员配置公司名称="测试中介A"，联系电话="400-123-4567"
When 点击"保存"
Then 这些信息显示在页面页脚、委托协议PDF、诊断报告PDF

Given 租户A配置Logo为LogoA.png，主色调为红色
And 租户B配置Logo为LogoB.png，主色调为蓝色
When 租户A的用户登录
Then 看到LogoA和红色主题
When 租户B的用户登录
Then 看到LogoB和蓝色主题
And 两个租户的配置互不影响
```

**不通过场景**：
- ❌ Logo上传后不显示或显示错误
- ❌ 主色调配置后未应用到所有UI元素
- ❌ 配置需要刷新或重启才生效
- ❌ 租户间配置相互干扰

---

#### 功能12：产品库/方案库启停开关

**输入**：
- 产品/方案的开关状态（启用/禁用）

**处理**：
- 更新库展示与匹配逻辑
- 被停用的条目：不展示、不参与匹配

**输出**：
- 更新后的产品库/方案库展示

**异常分支**：
- 正在被引用的产品被禁用 → 允许禁用，但历史报告保留"当时引用版本"，新生成不再出现

**验收用例**：
```gherkin
Given 系统中有20个银行产品
And 租户A希望只显示其中5个产品
When 管理员配置：启用产品1-5，停用产品6-20
And 点击"保存"
Then 诊断匹配时只使用启用的5个产品
And 产品推荐列表只显示这5个产品

Given 系统中有12个改造方案
And 租户A停用其中9个方案
When 为B类客户生成改造方案
Then 只推荐启用的3个方案

Given 管理员启用了5个产品
When 拖拽调整产品显示顺序
And 点击"保存"
Then 产品推荐列表按新顺序显示
```

**不通过场景**：
- ❌ 停用产品后仍出现在推荐列表
- ❌ 产品排序未生效
- ❌ 开关配置延迟生效（超过1分钟）
- ❌ 新租户默认配置错误

---

### D. 分佣功能（2项功能）

#### 功能13：披露勾选（强制）

**输入**：
- 推荐服务商时的返佣披露信息
- 中介勾选动作

**处理**：
- 推荐服务商必须展示返佣披露
- 中介必须勾选"已了解返佣分配"
- 企业主页面需展示"可自选服务商"
- 未披露=不推荐（硬规则）

**输出**：
- 勾选留痕（谁、何时、勾选内容）
- 可继续下一步（生成订单/对账）

**异常分支**：
- 未勾选 → 阻断流程（无法继续）
- 披露字段不完整（缺返佣比例/分配说明） → 阻断推荐

**验收用例**：
```gherkin
Given B类客户"企业B001"需要改造
When 系统生成改造方案并推荐服务商A
Then 服务商卡片必须显示：
    - 服务商名称：XX财税咨询
    - 服务内容：开票提升服务
    - 预计费用：2-3万
    - ⚠️返佣披露："推荐该服务商可获得服务费10%的返佣"
    - ⚠️说明："企业主可自行选择其他服务商"

Given 改造方案显示了服务商推荐
When 中介点击"发送方案给客户"
Then 弹出确认对话框："请确认您已向客户说明返佣情况"
And 勾选框："□ 我已了解返佣分配，并将向客户披露"
When 中介未勾选，直接点击"确认"
Then 系统提示："请勾选确认项"
And 无法发送方案
When 中介勾选后点击"确认"
Then 方案成功发送
And 系统记录勾选时间和操作人

Given 企业主收到改造方案
When 查看服务商推荐
Then 页面显示："您可以选择以下推荐服务商，也可以自己寻找其他服务商"
```

**不通过场景**：
- ❌ 服务商推荐未显示返佣披露
- ❌ 未勾选确认也能发送方案
- ❌ 企业主页面未显示"可自选服务商"提示
- ❌ 勾选记录未保存

#### 企业主页面实现方式（V0裁决）

**背景**：返佣披露要求企业主能看到"可自选服务商"提示，这是合规要求。

**V0最简实现**（二选一）：

**方式A：PDF中包含文字说明**（最简单，推荐用于极简MVP）
- 改造方案PDF中包含醒目提示（独立段落，加粗）：
  - "您可以选择以下推荐服务商，也可以自己寻找其他服务商"
  - "推荐服务商可能向中介支付返佣"
- 无需额外开发页面
- 验收：PDF中必须包含此文字，位置醒目

**方式B：简单的只读分享页**（推荐，用户体验更好）
- 中介生成临时分享链接（带token）
- 有效期7天（可配置）
- 只读展示：服务商推荐+文字说明
- 不涉及企业主登录/注册

**安全验收用例（如果选择方式B）**：
```gherkin
Given 中介为客户"企业B001"生成了改造方案
When 点击"生成分享链接"
Then 系统生成带token的URL（格式：/share/{token}）
And 有效期=当前时间+7天

Given 企业主访问分享链接
When 在有效期内打开链接
Then 显示改造方案内容（只读）
And 醒目显示："您可以选择推荐服务商，也可以自己寻找其他服务商"
And 页面无任何编辑入口

Given 分享链接生成7天后
When 尝试访问该链接
Then 显示"链接已过期，请联系中介重新生成"
And 不展示任何客户数据

Given 租户A的分享链接（包含token_A）
When 修改URL中的token为随机值（猜测token）
Then 返回403错误或"无效链接"
And 不泄露任何数据

Given 分享链接已过期
When 中介点击"重新生成链接"
Then 生成新的有效链接（token更新，旧token失效）
```

**V1规划**：
- 完整的企业主账户体系
- 企业主可查看历史记录
- 企业主可在线确认方案

---

#### 功能14：对账记录（返佣交易可追溯）

**输入**：
- 订单号（自动生成）
- 金额、服务完成状态、返佣比例、分配记录

**处理**：
- 记录交易全流程节点
- 完成定义：服务商提交验收报告+中介确认

**输出**：
- 可查询、可导出、可审计的对账记录（分配记录清晰）

**异常分支**：
- 退款/争议：至少能记录"状态=争议中/已退款"，保留原因与附件（V0可先做最简状态字段）

**验收用例**：
```gherkin
Given 客户"企业B001"使用了服务商A的服务
When 中介在系统中创建对账记录：
    - 订单号：自动生成（FY202602020001）
    - 客户：企业B001
    - 服务商：XX财税咨询
    - 服务内容：开票提升服务
    - 服务费：30000元
    - 返佣比例：10%
    - 返佣金额：3000元
    - 服务完成状态：已完成
And 点击"保存"
Then 系统保存对账记录
And 订单号唯一且可追溯

Given 系统中有100条对账记录
When 中介查询"2026年2月"的对账记录
Then 显示2月份所有记录
And 可按服务商/客户/状态/金额范围筛选
And 显示汇总：总服务费XX元，总返佣XX元

Given 对账记录"FY202602020001"
When 查看该记录详情
Then 显示完整分配记录：
    - 服务费：30000元
    - 中介返佣：3000元（10%）
    - 支付状态：已支付/未支付
    - 支付时间：2026-02-15

Given 中介需要生成月度对账报表
When 选择"2026年2月"，点击"导出报表"
Then 系统生成Excel报表，包含所有对账记录明细、汇总
And Excel可成功下载

Given 对账记录"FY202602020001"已创建
When 中介修改返佣金额（3000元→3500元）
Then 系统记录修改历史（修改前后、修改人、修改时间、修改原因）
And 修改历史可查询
```

**不通过场景**：
- ❌ 对账记录创建失败或数据丢失
- ❌ 订单号重复或格式错误
- ❌ 金额计算错误（返佣金额≠服务费×返佣比例）
- ❌ 修改未记录历史

---

---

### 功能15：结果回填（数据飞轮核心）⭐⭐⭐

**功能描述**：
每次客户申请贷款（无论通过/拒绝），中介必须回填结果到系统，为数据飞轮积累"种子数据"。

**为什么P0**：
- 这是"种树"的种子（没有这个，系统永远不会变聪明）
- 这是数据飞轮的启动点
- V0只做最小可用版（15A），为后续迭代留下空间

**分期策略**：
```
15A（V0，本次）：录入 + 归因 + 留痕
15B（V0.1，2周后）：基础统计 + 导出CSV
15C（V1/V2，3个月后）：差异分析 + 规则优化
```

---

#### 15A.1 结果录入（V0范围）

**输入字段**：
| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| 客户ID | 文本 | ✅ | 系统自动关联 | C001 |
| 申请产品 | 下拉 | ✅ | 系统自动带出 | 建行云税贷 |
| 申请额度 | 数字 | ✅ | 实际申请额度 | 80万 |
| 申请时间 | 日期 | ✅ | 系统自动记录 | 2026-02-05 |
| 审批结果 | 下拉 | ✅ | 通过/拒绝/待审批 | 拒绝 |
| 实际批额 | 数字 | ⚠️ | 通过时必填 | 50万 |
| 拒绝原因 | 下拉 | ⚠️ | 拒绝时必填，必须归类到六宫格 | 流水体质-流水不足 |
| 备注 | 文本 | ❌ | 补充说明 | 客户未提供完整材料 |

**拒绝原因选项**（强制归类到六宫格）：
```
流水体质：
- 流水不足
- 流水不稳定
- 客户集中度高

票税体质：
- 开票不足
- 纳税不足
- 票税不匹配

征信体质：
- 查询次数过多
- 负债过高
- 有逾期记录

资产体质：
- 无抵押物
- 抵押率不足
- 资产估值低

资质体质：
- 无相关资质
- 资质过期
- 资质不符合

行业体质：
- 限制行业
- 高风险行业

其他：
- 材料不全
- 客户放弃
- 银行系统问题
```

**操作流程**：
```
1. 中介在"客户详情"页点击"录入申请结果"
2. 系统自动带出：客户信息、申请产品
3. 中介填写：审批结果、实际批额/拒绝原因
4. 系统校验：
   - 通过时，实际批额必填
   - 拒绝时，拒绝原因必填且必须归类到六宫格
   - 拒绝原因不允许只选"其他"（必须选具体维度）
5. 保存到结果库
6. 写入审计日志（操作人、时间、客户ID、产品ID）
```

**验收用例**：
```
用例1：录入成功案例
- 输入：审批结果=通过，实际批额=50万
- 系统：保存成功，显示在客户详情"申请记录"列表中

用例2：录入失败案例（正常）
- 输入：审批结果=拒绝，拒绝原因=流水体质-流水不足
- 系统：保存成功，拒绝原因归类到"流水体质"维度

用例3：拒绝未归因（阻断）
- 输入：审批结果=拒绝，拒绝原因=空
- 系统：弹窗提示"请选择拒绝原因（必须归类到六宫格）"，阻止保存

用例4：拒绝只选"其他"（阻断）
- 输入：审批结果=拒绝，拒绝原因=其他
- 系统：弹窗提示"请选择具体原因维度，不能只选'其他'"，阻止保存
```

---

#### 15A.2 结果查看（V0范围）

**展示位置**：客户详情页 → 申请记录tab

**展示字段**：
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 申请记录

申请时间      产品           申请额度    审批结果    实际批额/拒绝原因
2026-02-05   建行云税贷      80万        拒绝        流水体质-流水不足
2026-01-20   农行纳税e贷     60万        通过        50万
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**操作**：
- 点击某条记录 → 查看详情（包含备注）
- V0不允许修改/删除（避免破坏审计留痕）

---

#### 15A.3 审计留痕（V0范围）

**审计日志字段**：
| 字段名 | 说明 |
|--------|------|
| 操作人 | partner_id（中介管理员） |
| 操作时间 | 精确到秒 |
| 操作类型 | 新增申请结果 |
| 关联客户 | customer_id |
| 关联产品 | product_id |
| 审批结果 | 通过/拒绝 |
| 拒绝原因 | 六宫格维度 |

**保留期限**：至少1年（符合合规要求）

---

#### 15A.4 软删除策略（合规要求）

**为什么需要软删除**：
- 合规要求：审计日志必须保留1年
- 如果客户删除采用"级联删除"，会破坏审计留痕
- 正确做法：标记删除（软删除），保留数据但不展示

**技术实现**：
```sql
-- 客户表新增字段
ALTER TABLE customers ADD COLUMN deleted_at TIMESTAMP;

-- 删除客户时
UPDATE customers SET deleted_at = NOW() WHERE id = 'C001';

-- 查询时过滤已删除
SELECT * FROM customers WHERE deleted_at IS NULL;

-- 结果库关联查询
SELECT r.* FROM results r
JOIN customers c ON r.customer_id = c.id
WHERE c.deleted_at IS NULL;
```

**保留期限**：
- 软删除记录至少保留1年（符合审计要求）
- 1年后可物理删除（需要定期清理任务）

**V0范围**：
- ✅ 客户删除改为软删除（标记deleted_at）
- ✅ 结果库数据保留（不物理删除）
- ❌ 定期清理任务（V1做）

---

#### 15A.5 验收标准（V0）

**功能性验收**：
```
✅ 1. 结果录入
   - 通过案例能正常录入
   - 拒绝案例能正常录入且必须归类到六宫格
   - 拒绝原因不能只选"其他"（必须阻断）
   
✅ 2. 结果查看
   - 客户详情页能看到"申请记录"列表
   - 点击记录能查看详情
   
✅ 3. 审计留痕
   - 每次录入都写入审计日志
   - 审计日志包含必要字段（谁/何时/什么客户/什么产品）
```

**非功能性验收**：
```
✅ 性能
   - 结果录入响应时间<2秒
   - 结果列表加载时间<1秒
   
✅ 数据一致性
   - 结果库、审计日志数据一致
   - 软删除客户时，结果数据保留（标记deleted_at）
   
✅ 权限
   - V0只有单一角色（中介管理员），所有人都能录入
   - V0不做"只有录入人可修改"的细粒度权限
```

---

#### 15A.6 Mock数据（测试用）
```json
// 成功案例
{
  "customer_id": "C001",
  "product": "建行云税贷",
  "applied_amount": 800000,
  "applied_at": "2026-02-05T10:30:00Z",
  "result": "通过",
  "approved_amount": 500000,
  "note": ""
}

// 失败案例
{
  "customer_id": "C002",
  "product": "农行纳税e贷",
  "applied_amount": 600000,
  "applied_at": "2026-02-04T15:20:00Z",
  "result": "拒绝",
  "reject_reason_category": "征信体质",
  "reject_reason": "查询次数过多",
  "note": "近6个月查询12次"
}
```

---

#### 15A.7 不做的内容（明确边界）

**V0不做（留给15B/15C）**：
```
❌ 差异分析（预测 vs 实际）
❌ 准确率统计（整体/产品/维度）
❌ 规则优化建议（错误模式识别）
❌ 可视化曲线（准确率趋势图）
❌ 细粒度权限（录入人限制）
❌ 结果修改/删除功能
```

**为什么不做**：
- V0目标是"种下种子"，不是"收获果实"
- 15B/15C需要足够样本才有意义（至少100条以上）
- 避免范围膨胀，保证V0在2周内交付

---

**关键提醒**：
1. ⚠️ 结果回填是V0的"种子"，不是"完整数据产品"
2. ⚠️ 拒绝原因必须归类到六宫格（系统强制）
3. ⚠️ 审计留痕必须完整（保留1年）

**设计哲学**：
> V0的功能15A是"种下种子"：
> - 录入 → 种子入土
> - 归因 → 标记种子类型
> - 留痕 → 记录种植过程
> 
> 等种子发芽（15B基础统计）、长大（15C规则优化），再谈收获。
> 
> **V0不求完美，但求种子种下。**

---

## 3. 三个拷问（质量保证）

在验收任何功能时，必须通过以下三个拷问：

### 拷问1：原子任务

- **输入是什么？**
  - 13字段客户数据
  - 产品&方案库
  - 披露与订单字段

- **处理是什么？**
  - 分层+缺口+任务+提醒+留痕

- **输出是什么？**
  - 三段式报告+方案包+提醒+对账记录

### 拷问2：供需匹配

- **会产出什么？**
  - 额度预测/方案推荐/技术文档

- **是用户需要的吗？**
  - 中介能立即用（导入→结论→下一步任务→提醒）
  - 开发能按用例验收

### 拷问3：铜臭味

- 是"好看"还是"好卖"？
  - **好卖**：B类方案包+服务商推荐+披露+对账
  - 把"建议"变成"可成交、可分佣、可合规"

- 中介能立即执行吗？开发者能立即开发吗？
  - **是**：每个功能都有输入/输出/验收用例

**通过标准**：三个拷问都能清晰回答，才算通过验收。

---

## 4. 行动清单（按优先级）

### P0（立刻落地，直接影响验收）

- [ ] **准备测试数据**
  - Excel模板+3份样例数据（合格/缺字段/格式错）
  - **重要**：模板必须基于13字段最终字典（不含"法人年龄"）
  - 租户A/B两套账号与数据（用于隔离与审计验收）
  
- [ ] **编写测试用例脚本**
  - 为14项各写3条自动化/半自动化测试用例（按G/W/T格式）
  
- [ ] **免责声明固化**
  - 统一免责声明文案为系统常量
  - 全站扫描测试（任何导出/报告都必须含免责声明）
  
- [ ] **性能基准测试**
  - 批量导入100条：≤5秒
  - 单次诊断：≤3秒
  - 界面响应：≤2秒

### P1（不阻断V0，但建议同步做）

- [ ] **性能压测记录**
  - 批量导入1000条测试
  - 并发10用户测试
  
- [ ] **对账争议状态**
  - 最简字段（争议中/已退款/原因）
  
- [ ] **用户手册**
  - 简单操作指南（给3个试点中介）

---

## 5. 风险与依赖

### 口径冲突风险

**域名配置口径**：
- 框架文档标注V1支持"独立域名绑定/SSL"
- PRD标注V0为"子域名"
- **裁决**：V0只做子域名/路径级入口；独立域名绑定进V1

### 试点依赖

- 需要3个中介完成可用性验收用例
- 如果中介未找到，可能影响验收周期

### 数据质量风险

- 13字段不全会导致诊断不可用
- 必须把"缺字段=待补全"做成明确分支（功能6/7/10）

### 性能风险

- SQLite在数据量大时可能性能不足
- V0先满足100条≤5秒，超出记录为性能缺陷但不阻断可用性

---

## 6. 变更记录（本轮新增/修改口径）

| 日期       | 版本 | 变更内容                                                     | 影响范围       |
| ---------- | ---- | ------------------------------------------------------------ | -------------- |
| 2026-02-02 | v1.2 | **冲突解决**：基于专家反馈解决文档冲突 | 全文档 |
| | | 1. 新增"0.1 V0部署形态裁决"：明确为多租户SaaS托管 | 全局验收 |
| | | 2. 修改"功能5"：13字段最终字典（不含"法人年龄"） | 功能5验收 |
| | | 3. 强化"功能2"：补充跨租户安全测试用例 | 功能2验收 |
| 2026-02-02 | v1.1 | **重大补充**：基于专家反馈，补充可复现规则 | 全文档 |
| | | 1. 新增"V0评分规则表"（6个维度分段规则+3组金样例） | 功能6验收 |
| | | 2. 新增"V0产品匹配与额度计算口径"（硬条件+公式+示例） | 功能7/8验收 |
| | | 3. 明确"V0一票否决项清单"（仅M3+逾期+代偿） | 功能6验收 |
| | | 4. 修改"性能验收"为三段式门槛（Pass/Pass*/Fail） | 功能5验收 |
| | | 5. 修改"免责声明验收"为黑盒测试（删除白盒描述） | 功能4验收 |
| | | 6. 补充"企业主页面实现方式"裁决（PDF文字OR简单分享页） | 功能13验收 |
| 2026-02-02 | v1.0 | 功能11"域名"口径裁决：V0=子域名/路径级；独立域名绑定/SSL=V1  | 功能11验收标准 |
| 2026-02-02 | v1.0 | 性能指标口径：100条≤5秒为V0验收目标，超过记录为性能缺陷但不阻断可用性 | 功能5性能验收  |
| 2026-02-02 | v1.0 | 明确"人工改判"只允许A↔B，不支持C类改判（避免风险）           | 功能10验收用例 |

---

## 7. 验收总结

### 通过标准

**单项功能通过**：
- ✅ 所有验收用例的Given/When/Then条件都满足
- ✅ 不通过场景都被正确拒绝
- ✅ 性能指标达标

**整体V0通过**：
- ✅ 14项P0功能全部单项通过
- ✅ 端到端流程可跑通（导入→诊断→输出→提醒）
- ✅ 3个中介完成实际测试并反馈"可用"

### 验收工具

**建议使用**：
1. 手动测试：按用例逐条执行
2. 自动化测试：关键流程（导入、诊断、分层）
3. 性能测试：批量导入、并发用户
4. 安全测试：租户隔离、权限控制

### 验收周期
```
Week 1：
- Day 1-3：合规底座4项功能验收
- Day 4-5：业务功能5-6验收
- Day 6-7：业务功能7-10验收

Week 2：
- Day 8-9：白标配置2项功能验收
- Day 10-11：分佣功能2项功能验收
- Day 12-13：集成测试+端到端验收
- Day 14：最终验收+交付准备
```

---

**文档版本**：v1.3  
**创建日期**：2026-02-02  
**维护人**：产品团队  
**适用对象**：开发团队、测试团队、产品经理  
**参考文档**：
- 00_核心文档/贷款中介业务基座-总纲-v1.1.md
- 05_开发文档/产品需求文档-V0版-v1.1.md
- 00_核心文档/项目进度追踪器-v2.0.md
